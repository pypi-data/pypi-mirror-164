From 2611d39704bdb6bb37429e39660d9dedbdfff35a Mon Sep 17 00:00:00 2001
From: Joachim Bauch <bauch@struktur.de>
Date: Fri, 14 May 2021 09:32:50 +0200
Subject: [PATCH] Assume encoded image has source size if no SPS is returned
 from encoder.

Found by Coverity Scan.
---
 libheif/heif_context.cc | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libheif/heif_context.cc b/libheif/heif_context.cc
index d536c0f9..871d7824 100644
--- a/libheif/heif_context.cc
+++ b/libheif/heif_context.cc
@@ -1966,7 +1966,8 @@ Error HeifContext::encode_image_as_hevc(std::shared_ptr<HeifPixelImage> image,
                  err.message);
   }
 
-  int encoded_width, encoded_height;
+  int encoded_width = image->get_width(heif_channel_Y);
+  int encoded_height = image->get_height(heif_channel_Y);
 
   for (;;) {
     uint8_t* data;

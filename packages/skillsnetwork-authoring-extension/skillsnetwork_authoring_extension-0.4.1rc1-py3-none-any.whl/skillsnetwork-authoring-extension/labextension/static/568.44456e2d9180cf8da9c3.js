"use strict";(self.webpackChunkskillsnetwork_authoring_extension=self.webpackChunkskillsnetwork_authoring_extension||[]).push([[568],{7953:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{Z:()=>y});var o=a(6484),l=a(1991),s=a(5923),r=a(2074),i=a(8623),c=a(3311),u=a(6973),d=a(3619),h=a(4972),b=a(4101),g=t([i,c,d,b,u]);[i,c,d,b,u]=g.then?(await g)():g;const w={activate:p,id:"skillsnetwork-authoring-extension:plugin",autoStart:!0,requires:[h.INotebookTracker,o.IDocumentManager,r.IMainMenu]};class m{createNew(t,e){const a=new l.ToolbarButton({className:"publish-lab-button",label:"Publish",onClick:async()=>{const a=await(0,i.nu)(t,e);(0,c.nK)((0,c.SJ)(d.OH.TOKEN),a)},tooltip:"Publish Lab"}),n=new l.ToolbarButton({className:"image-library-button",label:"Image Library",onClick:()=>(new b.p).launch(),tooltip:"Open Image Library"});return t.toolbar.insertItem(9,"image-library",n),t.toolbar.insertItem(10,"publish",a),new s.DisposableDelegate((()=>{a.dispose(),n.dispose()}))}}async function p(t,e,a){if(console.log("Activated skillsnetwork-authoring-extension button plugin!"),"learn"==await(0,d.IK)())return;const n=await(0,d.SD)(),o=await(0,d.D2)();if(console.log("Using default kernel: ",d.OH.PY_KERNEL_NAME),t.docRegistry.addWidgetExtension("Notebook",new m),"NO_TOKEN"!==n&&"local"!==o)try{const t=(0,i.aj)(n),e=(0,i.hV)(t);let o=await(0,c.B4)((0,c.SJ)(n));const l=a.createNew(e,"notebook",{name:d.OH.PY_KERNEL_NAME});if(void 0===l)throw Error("Error loading lab");(0,i.Te)(l,o),l.show()}catch(t){l.Dialog.flush(),(0,u.YZ)(),d.OH.TOKEN="NO_TOKEN",console.log(t)}}const y=w;n()}catch(k){n(k)}}))},3619:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{D2:()=>h,IK:()=>u,OH:()=>g,SD:()=>d,XM:()=>i,bn:()=>c,qz:()=>r});var o=a(6748),l=a(9581),s=a.n(l);const t=t=>{let e=t.baseUrl;return e.endsWith("/")||(e+="/"),e},i=await(async()=>{const e=window.location.href,a=new URL(e).searchParams.get("atlas_base_url");if(null===a){const e={method:"GET"},a=o.ServerConnection.makeSettings(),n=t(a)+"skillsnetwork-authoring-extension/config",l=await o.ServerConnection.makeRequest(n,e,a);return(await l.json()).ATLAS_BASE_URL}return decodeURIComponent(a)})(),c=await(async()=>{const e=window.location.href,a=new URL(e).searchParams.get("image_library_url");if(null===a){const e={method:"GET"},a=o.ServerConnection.makeSettings(),n=t(a)+"skillsnetwork-authoring-extension/config",l=await o.ServerConnection.makeRequest(n,e,a);return(await l.json()).IMAGE_LIBRARY_URL}return decodeURIComponent(a)})(),u=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("mode");return"learn"==e?e:"author"},d=async()=>{const t=window.location.href,e=new URL(t).searchParams;let a=sessionStorage.getItem("atlas_token");if(null===a){const t=e.get("atlas_token");a=null!==t?t:"NO_TOKEN"}return g.TOKEN=a,a},h=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("env_type");return"jupyterlab"!==e&&"jupyterlite"!==e&&(e="local"),console.log("Env type: ",e),"jupyterlab"===e||"local"===e?(g.PY_KERNEL_NAME=await b(),g.DEFAULT_LAB_NAME="lab.ipynb"):"jupyterlite"===e&&(g.PY_KERNEL_NAME="python",g.DEFAULT_LAB_NAME="lab.jupyterlite.ipynb"),e},b=async()=>{let t=await(await o.KernelSpecAPI.getSpecs()).kernelspecs,e=Object.keys(t).filter((function(t){return t.includes("python")})).sort();return e[e.length-1]};var r=s().CancelToken.source();class g{}n()}catch(t){n(t)}}),1)},6973:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{Up:()=>c,YZ:()=>h,fP:()=>d,wW:()=>u});var o=a(3992),l=a(1991),s=a(3619),r=t([s]);s=(r.then?(await r)():r)[0];class i extends o.Widget{constructor(){const t=document.createElement("div"),e=new l.Spinner;t.appendChild(e.node),t.style.padding="15px",super({node:t})}}const c=t=>{const e=new i;(0,l.showDialog)({title:t,body:e,buttons:[l.Dialog.cancelButton()]}).then((t=>{t.button.accept||s.qz.cancel("Operation cancelled by the user.")})).catch((t=>{}))},u=()=>{(0,l.showDialog)({title:"Success!",body:"This lab was successfully submitted for publishing!",buttons:[l.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},d=()=>{(0,l.showDialog)({title:"Failed to Publish",body:"This lab failed to publish.",buttons:[l.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},h=()=>{(0,l.showDialog)({title:"Failed to Load Lab",body:"This lab failed to load.",buttons:[l.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))};n()}catch(t){n(t)}}))},3311:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{B4:()=>d,SJ:()=>u,nK:()=>h});var o=a(6973),l=a(1991),s=a(3619),r=a(9581),i=a.n(r),c=t([s,o]);[s,o]=c.then?(await c)():c;const u=t=>i().create({baseURL:s.XM,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}),d=t=>t.get("v1/labs").then((t=>(l.Dialog.flush(),JSON.parse(t.data.body)))).catch((t=>{throw console.log(t),"Failed to fetch notebook"})),h=async(t,e)=>((0,o.Up)("Publishing..."),new Promise((async(a,n)=>{await t.post("v1/labs",{body:e},{cancelToken:s.qz.token}).then((t=>{console.log("SUCCESSFULLY PUSHED",t),l.Dialog.flush(),(0,o.wW)()})).catch((t=>{console.log(t),l.Dialog.flush(),(0,o.fP)()}))})));n()}catch(t){n(t)}}))},4101:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{p:()=>c});var o=a(3992),l=a(1991),s=a(3619),r=t([s]);s=(r.then?(await r)():r)[0];class i extends o.Widget{constructor(){const t=document.createElement("iframe");t.src=`${s.bn}?atlas_token=${s.OH.TOKEN}`,t.setAttribute("frameborder","0"),t.setAttribute("allow","clipboard-read; clipboard-write"),super({node:t})}}class c{launch(){const t=new l.Dialog({title:"Image Library",body:new i,hasClose:!0,buttons:[]}),e=t.node.querySelector(".jp-Dialog-content");e&&e.classList.add("image-library-dialog"),t.launch()}}n()}catch(t){n(t)}}))},1568:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.r(e),a.d(e,{default:()=>r});var o=a(4822),l=a(7953),s=t([l,o]);[l,o]=s.then?(await s)():s;const r=[l.Z,o.G];n()}catch(t){n(t)}}))},4822:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{G:()=>g});var o=a(2074),l=a(3992),s=a(1991),r=a(4972),i=a(6484),c=a(6973),u=a(8623),d=a(3311),h=a(3619),b=t([h,c,u,d]);[h,c,u,d]=b.then?(await b)():b;const g={id:"skillsnetwork-authoring-extension:menu",autoStart:!0,requires:[o.IMainMenu,r.INotebookTracker,i.IDocumentManager],activate:async(t,e,a,n)=>{if(console.log("Activated skillsnetwork-authoring-extension menu plugin!"),"learn"==await(0,h.IK)())return;const o="edit-lab-from-token";t.commands.addCommand(o,{label:"Edit a Lab",execute:()=>{b(a,n)}});const{commands:r}=t,i=new l.Menu({commands:r});i.title.label="Skills Network",e.addMenu(i,{rank:80}),i.addItem({command:o,args:{}});const b=(t,e)=>{let a=document.createElement("div"),n=document.createElement("label");n.textContent="Enter your authorization token: ";let o=document.createElement("input");o.className="jp-mod-styled",a.appendChild(n),a.appendChild(o),(0,s.showDialog)({title:"Edit a Lab",body:new l.Widget({node:a}),buttons:[s.Dialog.cancelButton(),s.Dialog.okButton()]}).then((async t=>{if(t.button.accept){(0,c.Up)("Loading up your lab...");const t=o.value,a=(0,u.aj)(t),n=(0,u.hV)(a);let l=await(0,d.B4)((0,d.SJ)(t));const s=e.createNew(n,"notebook",{name:h.OH.PY_KERNEL_NAME});if(void 0===s)throw Error("Error loading lab");(0,u.Te)(s,l),s.show(),h.OH.TOKEN=o.value,sessionStorage.setItem("atlas_token",h.OH.TOKEN)}})).catch((t=>{s.Dialog.flush(),(0,c.YZ)(),console.log(t)}))}}};n()}catch(t){n(t)}}))},8623:(t,e,a)=>{a.a(t,(async(t,n)=>{try{a.d(e,{Te:()=>u,aj:()=>d,hV:()=>h,nu:()=>c});var o=a(4972),l=a(6042),s=a(3619),r=t([s]);s=(r.then?(await r)():r)[0];const i=t=>({cell_type:t.model.type,id:t.model.id,metadata:{},outputs:[],source:[t.model.value.text]}),c=(t,e)=>{const a=[];t.content.widgets.forEach((t=>{const e=i(t);a.push(e)}));const n=e.model.metadata.toJSON(),o=e.model.nbformat,l=e.model.nbformatMinor,s={cells:a,metadata:n,nbformat:o,nbformat_minor:l};return JSON.stringify(s,null,2)},u=async(t,e,a)=>{const n=new o.NotebookModel;"local"!==a&&n.fromJSON(e),t.content.model=n},d=t=>{const e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=l.Buffer.from(e,"base64").toString(),n=decodeURIComponent(a.split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)},h=t=>{var e;let a=null!==(e=t.lab_filepath)&&void 0!==e?e:s.OH.DEFAULT_LAB_NAME;return a=a.replace("labs/",""),a};n()}catch(t){n(t)}}))}}]);
"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[6023],{3744:(t,e)=>{e.Z=(t,e)=>{const o=t.__vccOpts||t;for(const[t,a]of e)o[t]=a;return o}},9580:(t,e,o)=>{o.r(e),o.d(e,{default:()=>y});var a=o(6252);const i={class:"card"},s={class:"card-body"},n=(0,a._)("h1",null,"New Customer",-1),r=(0,a._)("hr",null,null,-1),l=(0,a.Uk)(" New Customer Form "),c=(0,a._)("hr",null,null,-1),u={class:"row"},d=(0,a._)("div",{class:"col-md-4"},[(0,a._)("strong",null,"Customer Organisation"),(0,a._)("p",{class:"text-instructions"}," This field is optional. If this customer does not have any organisations attached, it will treat this customer as a freelancer. ")],-1),m={class:"col-md-8"},h={class:"form-group col-sm-8"},g=(0,a._)("label",null,"Organisation:",-1),f=(0,a._)("hr",null,null,-1),_={class:"row submit-row"},p={class:"col-md-12"};var v=o(9669),M=o.n(v),w=o(5169),C=o(3766),b=o(2587),k=o(9113);const E={name:"NewCustomer",setup:()=>({v$:(0,C.ZP)()}),props:{organisationName:{type:String,default:""},rootUrl:{type:String,default:"/"},titleList:{type:Array,default:function(){return[]}}},mixins:[k.Z],data:()=>({customerEmailModel:"",customerFirstNameModel:"",customerLastNameModel:"",flagValidationCheck:!1,organisationFixList:[],organisationModel:{},titleModel:[]}),validations:{customerEmailModel:{required:b.C1,email:b.Do},customerFirstNameModel:{required:b.C1},customerLastNameModel:{required:b.C1},titleModel:{required:b.C1}},methods:{fetchOptions:function(t,e){this.searchTrigger({return_function:this.getOrganisationData,searchTimeout:this.searchTimeout,search:t,loading:e})},getOrganisationData:function(t,e){const o=new FormData;o.set("search",t),M().post(`${this.rootUrl}search/organisation/data/`,o).then((t=>{this.organisationFixList=[],t.data.forEach((t=>{var e={value:t.pk,organisation_name:t.fields.organisation_name,organisation_website:t.fields.organisation_website,organisation_email:t.fields.organisation_email,organisation_profile_picture:t.fields.organisation_profile_picture};this.organisationFixList.push(e)}));var e=this.organisationFixList.filter((t=>t.organisation_name==this.organisationName));e.length>0&&(this.organisationModel=e[0])})).catch((function(t){document.getElementById("errorModalContent").innerHTML=`<strong>Search Organisation Issue:</strong><br/>${t}`,new w.u_(document.getElementById("errorModal"),{keyboard:!1}).show(),document.getElementById("loader").style.display="none"}))},submitNewCustomer:function(){if(this.flagValidationCheck=!0,setTimeout((()=>{this.flagValidationCheck=!1}),100),this.v$.$touch(),this.v$.$invalid)return document.getElementById("errorModalContent").innerHTML="<strong>FORM ISSUE:</strong> Sorry, but can you please fill out the form completely.",void new w.u_(document.getElementById("errorModal")).show();const t=new FormData;t.set("customer_title",this.titleModel.value),t.set("customer_first_name",this.customerFirstNameModel),t.set("customer_last_name",this.customerLastNameModel),t.set("customer_email",this.customerEmailModel),0!=Object.keys(this.organisationModel).length&&t.set("organisation",this.organisationModel.value),M().post(`${this.rootUrl}new_customer/save/`,t).then((t=>{window.location.href=t.data})).catch((t=>{}))},updateCustomerData:function(t){this[t.field]=t.value}},mounted(){setTimeout((()=>{this.getOrganisationData("","")}),200)}},y=(0,o(3744).Z)(E,[["render",function(t,e,o,v,M,w){const C=(0,a.up)("new-customer-form"),b=(0,a.up)("v-select");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",s,[(0,a.kq)(" HEADER "),n,r,l,(0,a.Wm)(C,{"organisation-name":o.organisationName,"title-list":o.titleList,"flag-validation-check":M.flagValidationCheck,onUpdate_customer_data:e[0]||(e[0]=t=>w.updateCustomerData(t))},null,8,["organisation-name","title-list","flag-validation-check"]),(0,a.kq)(" CUSTOMER ORGANISATION "),c,(0,a._)("div",u,[d,(0,a._)("div",m,[(0,a._)("div",h,[g,(0,a.Wm)(b,{options:M.organisationFixList,onSearch:w.fetchOptions,modelValue:M.organisationModel,"onUpdate:modelValue":e[1]||(e[1]=t=>M.organisationModel=t),label:"organisation_name",class:"get-stakeholders"},null,8,["options","onSearch","modelValue"])])])]),(0,a.kq)(" REMEMBER TO ADD IN USER PERMISSIONS HERE!! "),(0,a.kq)(" Submit Button "),f,(0,a._)("div",_,[(0,a._)("div",p,[(0,a._)("a",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:e[2]||(e[2]=(...t)=>w.submitNewCustomer&&w.submitNewCustomer(...t))},"Submit Customer")])])])])}]])},9113:(t,e,o)=>{o.d(e,{Z:()=>a});const a={methods:{searchTrigger:function(t){""!=t.searchTimeout&&clearTimeout(t.searchTimeout),void 0===t.search?this.searchUndefined(t):this.searchDefined(t)},searchDefined:function(t){t.search.length>=3&&(t.searchTimeout=setTimeout(t.return_function,500,t.search,t.loading))},searchUndefined:function(t){t.searchTimeout=setTimeout(t.return_function,500)}}}}}]);
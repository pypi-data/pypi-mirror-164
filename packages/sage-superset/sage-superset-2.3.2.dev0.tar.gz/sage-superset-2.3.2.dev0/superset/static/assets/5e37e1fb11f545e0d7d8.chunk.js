"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8371],{388371:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});var n,a,s,l=r(667294),c=r(263475),u=r(806915),o=r(211965);function i({formData:e,height:t,width:r,echartOptions:n,groupby:a,labelMap:s,selectedValues:i,setDataMask:d,legendData:f=[]}){const{emitFilter:h,stack:p}=e,g=(0,l.useRef)(null),m=(0,l.useRef)(Date.now()),v=(0,l.useRef)(""),b=(0,l.useRef)(),H=(0,l.useCallback)((e=>{var t;const r=null==(t=g.current)?void 0:t.getEchartInstance();e?f.forEach((t=>{t===e?(u.aI.legend=t,null==r||r.dispatchAction({type:"legendSelect",name:t})):null==r||r.dispatchAction({type:"legendUnSelect",name:t})})):(u.aI.legend="",null==r||r.dispatchAction({type:"legendAllSelect"}))}),[f]),E=(0,l.useCallback)((e=>{if(!h)return;const t=e.map((e=>s[e]));d({extraFormData:{filters:0===e.length?[]:a.map(((e,r)=>{const n=t.map((e=>e[r]));return null==n?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:n}}))},filterState:{label:t.length?t:void 0,value:t.length?t:null,selectedValues:e.length?e:null}})}),[a,s,d]),y={click:e=>{b.current&&clearTimeout(b.current),b.current=setTimeout((()=>{const{seriesName:t}=e,r=Object.values(i);r.includes(t)?E(r.filter((e=>e!==t))):E([t])}),300)},mouseout:()=>{u.aI.name=""},mouseover:e=>{u.aI.name=e.seriesName},legendselectchanged:e=>{const t=Date.now();t-m.current<300&&v.current===e.name?H(e.name):(m.current=t,v.current=e.name),Object.values(e.selected).every((e=>!e))&&H()}},R={dblclick:e=>{var t;b.current&&clearTimeout(b.current);const r=[e.offsetX,e.offsetY],n=null==(t=g.current)?void 0:t.getEchartInstance();if(null!=n&&n.containPixel("grid",r)){var a;if(!p&&"ec-polygon"===(null==(a=e.target)?void 0:a.type))return;const t=n.getModel(),r=((e,t)=>{let r=e,n=null;for(;r;){const e=r.__ecComponentInfo;if(null!=e){n=t.getComponent(e.mainType,e.index);break}r=r.parent}return n})(e.target,t),s=t.getSeriesCount(),l=t.getCurrentSeriesIndices();if(r){const{name:e}=r;s!==l.length?H():H(e)}}}};return(0,o.tZ)(c.Z,{ref:g,height:t,width:r,echartOptions:n,eventHandlers:y,zrEventHandlers:R,selectedValues:i})}e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),("undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e})(i,"useRef{echartRef}\nuseRef{lastTimeRef}\nuseRef{lastSelectedLegend}\nuseRef{clickTimer}\nuseCallback{handleDoubleClickChange}\nuseCallback{handleChange}"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(a.register(300,"TIMER_DURATION","/Users/chenming/superset/superset-frontend/plugins/plugin-chart-echarts/src/Timeseries/EchartsTimeseries.tsx"),a.register(i,"EchartsTimeseries","/Users/chenming/superset/superset-frontend/plugins/plugin-chart-echarts/src/Timeseries/EchartsTimeseries.tsx")),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)},263475:(e,t,r)=>{r.d(t,{Z:()=>f});var n,a=r(667294),s=r(751995),l=r(229027),c=r(211965);e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const o=s.iK.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function i({width:e,height:t,echartOptions:r,eventHandlers:n,zrEventHandlers:s,selectedValues:u={}},i){const d=(0,a.useRef)(null),f=(0,a.useRef)(),h=(0,a.useMemo)((()=>Object.keys(u)||[]),[u]),p=(0,a.useRef)([]);return(0,a.useImperativeHandle)(i,(()=>({getEchartInstance:()=>f.current}))),(0,a.useEffect)((()=>{d.current&&(f.current||(f.current=(0,l.S1)(d.current)),Object.entries(n||{}).forEach((([e,t])=>{var r,n;null==(r=f.current)||r.off(e),null==(n=f.current)||n.on(e,t)})),Object.entries(s||{}).forEach((([e,t])=>{var r,n;null==(r=f.current)||r.getZr().off(e),null==(n=f.current)||n.getZr().on(e,t)})),f.current.setOption(r,!0))}),[r,n,s]),(0,a.useEffect)((()=>{f.current&&(f.current.dispatchAction({type:"downplay",dataIndex:p.current.filter((e=>!h.includes(e)))}),h.length&&f.current.dispatchAction({type:"highlight",dataIndex:h}),p.current=h)}),[h]),(0,a.useEffect)((()=>{f.current&&f.current.resize({width:e,height:t})}),[e,t]),(0,c.tZ)(o,{ref:d,height:t,width:e})}u(i,"useRef{divRef}\nuseRef{chartRef}\nuseMemo{currentSelection}\nuseRef{previousSelection}\nuseImperativeHandle{}\nuseEffect{}\nuseEffect{}\nuseEffect{}",(()=>[a.useImperativeHandle]));const d=(0,a.forwardRef)(i),f=d;var h,p;(h="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(h.register(o,"Styles","/Users/chenming/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx"),h.register(i,"Echart","/Users/chenming/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx"),h.register(d,"default","/Users/chenming/superset/superset-frontend/plugins/plugin-chart-echarts/src/components/Echart.tsx")),(p="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&p(e)}}]);
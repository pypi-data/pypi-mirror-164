"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1653],{33121:(e,t,o)=>{o.d(t,{Z:()=>p});var r=o(478918),_=o(380744),a=o(838550),s=o(671435),i=o(762112),l=o(199890),n=o(398452);const d=[0,0,0,255],c={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:d},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class p extends r.Z{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&_.Z.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:o}){const r=o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPolygon);if(r&&Array.isArray(o.dataChanged)){const e=this.state.paths.slice(),t=o.dataChanged.map((t=>(0,n.b)({data:e,getIndex:e=>e.__source.index,dataRange:t,replace:this._getPaths(t)})));this.setState({paths:e,pathsDiff:t})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:o,positionFormat:r,_normalize:_}=this.props,s=[],i="XY"===r?2:3,{startRow:n,endRow:d}=e,{iterable:c,objectInfo:p}=(0,a.jB)(t,n,d);for(const e of c){p.index++;let t=o(e,p);_&&(t=l.F(t,i));const{holeIndices:r}=t,a=t.positions||t;if(r)for(let t=0;t<=r.length;t++){const o=a.slice(r[t-1]||0,r[t]||a.length);s.push(this.getSubLayerRow({path:o},e,p.index))}else s.push(this.getSubLayerRow({path:a},e,p.index))}return s}renderLayers(){const{data:e,_dataDiff:t,stroked:o,filled:r,extruded:_,wireframe:a,_normalize:l,_windingOrder:n,elevationScale:c,transitions:p,positionFormat:u}=this.props,{lineWidthUnits:g,lineWidthScale:h,lineWidthMinPixels:E,lineWidthMaxPixels:P,lineJointRounded:y,lineMiterLimit:L,lineDashJustified:f}=this.props,{getFillColor:m,getLineColor:D,getLineWidth:M,getLineDashArray:C,getElevation:b,getPolygon:O,updateTriggers:T,material:A}=this.props,{paths:R,pathsDiff:k}=this.state,U=this.getSubLayerClass("fill",s.Z),v=this.getSubLayerClass("stroke",i.Z),W=this.shouldRenderSubLayer("fill",R)&&new U({_dataDiff:t,extruded:_,elevationScale:c,filled:r,wireframe:a,_normalize:l,_windingOrder:n,getElevation:b,getFillColor:m,getLineColor:_&&a?D:d,material:A,transitions:p},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:T.getPolygon,getElevation:T.getElevation,getFillColor:T.getFillColor,lineColors:_&&a,getLineColor:T.getLineColor}}),{data:e,positionFormat:u,getPolygon:O});return[!_&&W,!_&&o&&this.shouldRenderSubLayer("stroke",R)&&new v({_dataDiff:k&&(()=>k),widthUnits:g,widthScale:h,widthMinPixels:E,widthMaxPixels:P,jointRounded:y,miterLimit:L,dashJustified:f,_pathType:"loop",transitions:p&&{getWidth:p.getLineWidth,getColor:p.getLineColor,getPath:p.getPolygon},getColor:this.getSubLayerAccessor(D),getWidth:this.getSubLayerAccessor(M),getDashArray:this.getSubLayerAccessor(C)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:T.getLineWidth,getColor:T.getLineColor,getDashArray:T.getLineDashArray}}),{data:R,positionFormat:u,getPath:e=>e.path}),_&&W]}}p.layerName="PolygonLayer",p.defaultProps=c},381653:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{getLayer:()=>getLayer,default:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),deck_gl__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(33121),_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(815354),_components_Legend__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36665),_TooltipRow__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(101740),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(10464),_common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(452154),_utils_time__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(166911),_utils_sandbox__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(621207),_utils_getPointsFromPolygon__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(136933),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const DOUBLE_CLICK_TRESHOLD=250;function getElevation(e,t){return 0===t(e)[3]?0:e.elevation}function setTooltipContent(e){return t=>{const o=e.metric.label||e.metric;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)("div",{className:"deckgl-tooltip"},t.object.name&&(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)(_TooltipRow__WEBPACK_IMPORTED_MODULE_4__.Z,{label:"name: ",value:`${t.object.name}`}),t.object[e.line_column]&&(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)(_TooltipRow__WEBPACK_IMPORTED_MODULE_4__.Z,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),e.metric&&(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)(_TooltipRow__WEBPACK_IMPORTED_MODULE_4__.Z,{label:`${o}: `,value:`${t.object[o]}`}))}}function getLayer(e,t,o,r,_,a,s){const i=e,l=i.fill_color_picker,n=i.stroke_color_picker;let d=[...t.data.features];if(null!=s&&s.forEach((e=>{d=d.filter((t=>e(t)))})),i.js_data_mutator){const e=(0,_utils_sandbox__WEBPACK_IMPORTED_MODULE_8__.Z)(i.js_data_mutator);d=e(d)}const c=i.metric?i.metric.label||i.metric:null,p=null===i.metric?()=>[l.r,l.g,l.b,255*l.a]:(0,_utils__WEBPACK_IMPORTED_MODULE_5__.SK)(i,d,(e=>e[c])),u=e=>{const t=p(e);return _.length>0&&!_.includes(e[i.line_column])&&(t[3]/=2),t},g=i.line_column&&i.metric&&["json","geohash","zipcode"].includes(i.line_type)?setTooltipContent(i):void 0;return new deck_gl__WEBPACK_IMPORTED_MODULE_12__.Z({id:`path-layer-${i.slice_id}`,data:d,pickable:!0,filled:i.filled,stroked:i.stroked,getPolygon:_utils_getPointsFromPolygon__WEBPACK_IMPORTED_MODULE_9__.Z,getFillColor:u,getLineColor:[n.r,n.g,n.b,255*n.a],getLineWidth:i.line_width,extruded:i.extruded,getElevation:e=>getElevation(e,u),elevationScale:i.multiplier,fp64:!0,...(0,_common__WEBPACK_IMPORTED_MODULE_6__.N)(i,r,g,a)})}const propTypes={formData:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,payload:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,setControlValue:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,viewport:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,onAddFilter:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,width:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired},defaultProps={onAddFilter(){}};class DeckGLPolygon extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=DeckGLPolygon.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){const{width:o,height:r,formData:_,payload:a}=e;if(t&&a.form_data===t.formData)return null;const s=a.data.features||[],i=s.map((e=>e.__timestamp)),l=a.form_data.time_grain_sqla||a.form_data.granularity||"P1D",{start:n,end:d,getStep:c,values:p,disabled:u}=(0,_utils_time__WEBPACK_IMPORTED_MODULE_7__.g)(i,l);let{viewport:g}=e;return _.autozoom&&(g=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_10__.Z)(g,{width:o,height:r,points:s.flatMap(_utils_getPointsFromPolygon__WEBPACK_IMPORTED_MODULE_9__.Z)})),{start:n,end:d,getStep:c,values:p,disabled:u,viewport:g,selected:[],lastClick:0,formData:a.form_data}}onSelect(e){const{formData:t,onAddFilter:o}=this.props,r=new Date,_=r-this.state.lastClick<=DOUBLE_CLICK_TRESHOLD,a=[...this.state.selected];if(_)a.splice(0,a.length,e);else if(t.toggle_polygons){const t=a.indexOf(e);-1===t?a.push(e):a.splice(t,1)}else a.splice(0,1,e);this.setState({selected:a,lastClick:r}),t.table_filter&&o(t.line_column,a,!1,!0)}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){if(void 0===this.props.payload.data.features)return[];const t=[];return e[0]===e[1]||e[1]===this.end?t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1])),[getLayer(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,t)]}render(){const{payload:e,formData:t,setControlValue:o}=this.props,{start:r,end:_,getStep:a,values:s,disabled:i,viewport:l}=this.state,n=t,d=n.metric?n.metric.label||n.metric:null,c=(0,_utils__WEBPACK_IMPORTED_MODULE_5__.So)(t,e.data.features,(e=>e[d]));return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)("div",{style:{position:"relative"}},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)(_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.Z,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:r,end:_,getStep:a,values:s,disabled:i,viewport:l,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:o,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==t.metric&&(0,_emotion_react__WEBPACK_IMPORTED_MODULE_11__.tZ)(_components_Legend__WEBPACK_IMPORTED_MODULE_3__.Z,{categories:c,position:t.legend_position,format:t.legend_format})))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}DeckGLPolygon.propTypes=propTypes,DeckGLPolygon.defaultProps=defaultProps;const _default=DeckGLPolygon,__WEBPACK_DEFAULT_EXPORT__=_default;var reactHotLoader,leaveModule;reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(DOUBLE_CLICK_TRESHOLD,"DOUBLE_CLICK_TRESHOLD","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(getElevation,"getElevation","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(setTooltipContent,"setTooltipContent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(getLayer,"getLayer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(DeckGLPolygon,"DeckGLPolygon","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx"),reactHotLoader.register(_default,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Polygon/Polygon.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},10464:(e,t,o)=>{o.d(t,{SK:()=>p,So:()=>u});var r,_,a,s=o(804065),i=o(603950),l=o(902995),n=o(45511),d=o(464106);function c({break_points:e,num_buckets:t},o,r){if(!o)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):10,[_,a]=(0,s.extent)(o,r);if(void 0===_)return[];const i=(a-_)/e,l=0===i?0:Math.max(0,Math.ceil(Math.log10(1/i))),n=a>a.toFixed(l)?1:0;return new Array(e+1+n).fill().map(((e,t)=>(_+t*i).toFixed(l)))}return e.sort(((e,t)=>parseFloat(e)-parseFloat(t)))}function p({break_points:e,num_buckets:t,linear_color_scheme:o,opacity:r},_,a){const p=e||t?c({break_points:e,num_buckets:t},_,a):null,u=Array.isArray(o)?new l.Z({colors:o,id:"custom"}):(0,n.Z)().get(o);let g,h;if(null!==p){const e=p.length-1,t=e>1?u.getColors(e):[u.colors[u.colors.length-1]],o=t[0],r=t[t.length-1];t.unshift(o),t.push(r);const _=p.map((e=>parseFloat(e)));g=(0,i.Z)().domain(_).range(t),h=t=>t>p[e]||t<p[0]}else g=u.createLinearScale((0,s.extent)(_,a)),h=()=>!1;return e=>{const t=a(e),o=(0,d.hexToRGB)(g(t));return h(t)?o[3]=0:o[3]=r/100*255,o}}function u(e,t,o){const r=c(e,t,o),_=p(e,t,o),a={};return r.slice(1).forEach(((t,o)=>{const s=`${r[o]} - ${r[o+1]}`,i=.5*(parseFloat(r[o])+parseFloat(r[o+1])),l=e.metric?e.metric.label||e.metric:null;a[s]={color:_({[l||e.metric]:i}),enabled:!0}})),a}e=o.hmd(e),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&r(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(_="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(_.register(10,"DEFAULT_NUM_BUCKETS","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/utils.js"),_.register(c,"getBreakPoints","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/utils.js"),_.register(p,"getBreakPointColorScaler","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/utils.js"),_.register(u,"getBuckets","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/utils.js")),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)},136933:(e,t,o)=>{var r,_,a;function s(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}o.d(t,{Z:()=>s}),e=o.hmd(e),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&r(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(_="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&_.register(s,"getPointsFromPolygon","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/utils/getPointsFromPolygon.ts"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)}}]);
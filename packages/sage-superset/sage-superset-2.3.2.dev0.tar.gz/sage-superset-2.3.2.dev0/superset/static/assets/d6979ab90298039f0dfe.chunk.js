"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1382],{639023:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>CategoricalDeckGLContainer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(328062),_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(815354),_components_Legend__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36665),_utils_colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(464106),_utils_time__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(166911),_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(621207),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const{getScale}=_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__;function getCategories(e,t){const o=e.color_picker||{r:0,g:0,b:0,a:1},r=[o.r,o.g,o.b,255*o.a],a=getScale(e.color_scheme),n={};return t.forEach((t=>{if(null!=t.cat_color&&!n.hasOwnProperty(t.cat_color)){let s;s=e.dimension?(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(a(t.cat_color),255*o.a):r,n[t.cat_color]={color:s,enabled:!0}}})),n}const propTypes={datasource:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,formData:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,getLayer:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,getPoints:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired,mapboxApiKey:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string.isRequired,onAddFilter:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,payload:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,setControlValue:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,viewport:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,width:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired};class CategoricalDeckGLContainer extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState({...this.getStateFromProps(e)})}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const o=e.payload.data.features||[],r=o.map((e=>e.__timestamp)),a=getCategories(e.formData,o);if(t&&e.payload.form_data===t.formData)return{...t,categories:a};const n=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:s,end:i,getStep:_,values:c,disabled:l}=(0,_utils_time__WEBPACK_IMPORTED_MODULE_5__.g)(r,n),{width:d,height:p,formData:u}=e;let{viewport:g}=e;return u.autozoom&&(g=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__.Z)(g,{width:d,height:p,points:e.getPoints(o)})),g.zoom<0&&(g.zoom=0),{start:s,end:i,getStep:_,values:c,disabled:l,viewport:g,selected:[],lastClick:0,formData:e.payload.form_data,categories:a}}getLayers(e){const{getLayer:t,payload:o,formData:r,onAddFilter:a}=this.props;let n=o.data.features?[...o.data.features]:[];n=this.addColor(n,r),r.js_data_mutator&&(n=(0,_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__.Z)(r.js_data_mutator)(n)),n=e[0]===e[1]||e[1]===this.end?n.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):n.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]));const s=this.state.categories;return r.dimension&&(n=n.filter((e=>s[e.cat_color]&&s[e.cat_color].enabled))),[t(r,{...o,data:{...o.data,features:n}},a,this.setTooltip,this.props.datasource)]}addColor(e,t){const o=t.color_picker||{r:0,g:0,b:0,a:1},r=getScale(t.color_scheme);return e.map((e=>{let a;return t.dimension?(a=(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(r(e.cat_color),255*o.a),{...e,color:a}):e}))}toggleCategory(e){const t=this.state.categories[e],o={...this.state.categories,[e]:{...t,enabled:!t.enabled}};Object.values(o).every((e=>!e.enabled))&&Object.values(o).forEach((e=>{e.enabled=!0})),this.setState({categories:o})}showSingleCategory(e){const t={...this.state.categories};Object.values(t).forEach((e=>{e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}render(){return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)("div",{style:{position:"relative"}},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_components_Legend__WEBPACK_IMPORTED_MODULE_3__.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;CategoricalDeckGLContainer.propTypes=propTypes,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(getScale,"getScale","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(getCategories,"getCategories","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(CategoricalDeckGLContainer,"CategoricalDeckGLContainer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},36665:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Legend});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(767190),_Legend_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(323270),_emotion_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const categoryDelimiter=" - ",propTypes={categories:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object,forceCategorical:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,format:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,position:prop_types__WEBPACK_IMPORTED_MODULE_1___default().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,toggleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func},defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}};class Legend extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(categoryDelimiter)){const t=e.split(categoryDelimiter);return this.format(t[0])+categoryDelimiter+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((([e,t])=>{const o={color:`rgba(${t.color.join(", ")})`},r=t.enabled?"◼":"◻";return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("li",{key:e},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("span",{style:o},r)," ",this.formatCategoryLabel(e)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("div",{className:"legend",style:t},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("ul",{className:"categories"},e))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;Legend.propTypes=propTypes,Legend.defaultProps=defaultProps,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(categoryDelimiter,"categoryDelimiter","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(Legend,"Legend","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},821382:(e,t,o)=>{o.r(t),o.d(t,{default:()=>y,getLayer:()=>E});var r=o(495772),a=o(693844),n=o(151331),s=o(100281),i=o(453982);const _=[0,0,0,255],c={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:_},getTargetColor:{type:"accessor",value:_},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class l extends r.Z{getShaders(){return super.getShaders({vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  if (dh == 0.0) {\n    return sourceZ + deltaZ * ratio;\n  }\n  float unitZ = deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n  vec3 source;\n  vec3 target;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source_world = instanceSourcePositions;\n    vec3 target_world = instanceTargetPositions;\n    if (useShortestPath) {\n      source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n      target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n\n      float deltaLng = target_world.x - source_world.x;\n      if (deltaLng > 180.) target_world.x -= 360.;\n      if (deltaLng < -180.) source_world.x -= 360.;\n    }\n    source = project_position(source_world, instanceSourcePositions64Low);\n    target = project_position(target_world, instanceTargetPositions64Low);\n    float antiMeridianX = 0.0;\n\n    if (useShortestPath) {\n      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n      }\n      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\n\n      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\n        isValid = 0.0;\n        indexDir = sign(segmentRatio - thresholdRatio);\n        segmentRatio = thresholdRatio;\n      }\n    }\n\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n\n    if (useShortestPath) {\n      if (nextPos.x < antiMeridianX) {\n        currPos.x += TILE_SIZE;\n        nextPos.x += TILE_SIZE;\n      }\n    }\n\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[a.Z,n.Z]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:_},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:_},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState({props:e,oldProps:t,changeFlags:o}){if(super.updateState({props:e,oldProps:t,changeFlags:o}),o.extensionsChanged){var r;const{gl:e}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{viewport:t}=this.context,{widthUnits:o,widthScale:r,widthMinPixels:a,widthMaxPixels:n,greatCircle:s,wrapLongitude:i}=this.props,_="pixels"===o?t.metersPerPixel:1;this.state.model.setUniforms(e).setUniforms({greatCircle:s,widthScale:r*_,widthMinPixels:a,widthMaxPixels:n,useShortestPath:i}).draw()}_getModel(e){let t=[];for(let e=0;e<50;e++)t=t.concat([e,1,0,e,-1,0]);const o=new s.Z(e,{...this.getShaders(),id:this.props.id,geometry:new i.Z({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0});return o.setUniforms({numSegments:50}),o}}l.layerName="ArcLayer",l.defaultProps=c,o(667294);var d,p=o(455867),u=o(452154),g=o(241667),h=o(101740),f=o(211965);function m(e){const t=[];return e.forEach((e=>{t.push(e.sourcePosition),t.push(e.targetPosition)})),t}function P(e){return t=>(0,f.tZ)("div",{className:"deckgl-tooltip"},(0,f.tZ)(h.Z,{label:`${(0,p.t)("Start (Longitude, Latitude)")}: `,value:`${t.object.sourcePosition[0]}, ${t.object.sourcePosition[1]}`}),(0,f.tZ)(h.Z,{label:`${(0,p.t)("End (Longitude, Latitude)")}: `,value:`${t.object.targetPosition[0]}, ${t.object.targetPosition[1]}`}),e.dimension&&(0,f.tZ)(h.Z,{label:`${e.dimension}: `,value:`${t.object.cat_color}`}))}function E(e,t,o,r){const a=t.data.features,n=e.color_picker,s=e.target_color_picker;return new l({data:a,getSourceColor:e=>e.sourceColor||e.color||[n.r,n.g,n.b,255*n.a],getTargetColor:e=>e.targetColor||e.color||[s.r,s.g,s.b,255*s.a],id:`path-layer-${e.slice_id}`,strokeWidth:e.stroke_width?e.stroke_width:3,...(0,u.N)(e,r,P(e))})}e=o.hmd(e),(d="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&d(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const D=(0,g.B)(E,m),y=D;var L,C;(L="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(L.register(m,"getPoints","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Arc/Arc.jsx"),L.register(P,"setTooltipContent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Arc/Arc.jsx"),L.register(E,"getLayer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Arc/Arc.jsx"),L.register(D,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Arc/Arc.jsx")),(C="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&C(e)},323270:()=>{},241667:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>createDeckGLComponent,B:()=>createCategoricalDeckGLComponent});var lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(618446),lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(667294),_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(287026),_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(639023),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function createDeckGLComponent(getLayer,getPoints){class Component extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_1__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&(null==t||t.setTooltip(e))};const{width:t,height:o,formData:r}=e;let{viewport:a}=e;r.autozoom&&(a=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__.Z)(a,{width:t,height:o,points:getPoints(e.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t={...e.formData,viewport:null},o={...this.props.formData,viewport:null};lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default()(t,o)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(e){const{formData:t,payload:o,onAddFilter:r}=e;return getLayer(t,o,r,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:o,height:r,width:a}=this.props,{layer:n,viewport:s}=this.state;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.F,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[n],mapStyle:e.mapbox_style,setControlValue:o,width:a,height:r,onViewportChange:this.onViewportChange})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}return Component}function createCategoricalDeckGLComponent(e,t){return function(o){const{datasource:r,formData:a,height:n,payload:s,setControlValue:i,viewport:_,width:c}=o;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__.Z,{datasource:r,formData:a,mapboxApiKey:s.data.mapboxApiKey,setControlValue:i,viewport:_,getLayer:e,payload:s,getPoints:t,width:c,height:n})}}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(createDeckGLComponent,"createDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx"),reactHotLoader.register(createCategoricalDeckGLComponent,"createCategoricalDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}}]);
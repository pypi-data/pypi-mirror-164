"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8549,7275,8146],{295644:(e,t,o)=>{o.d(t,{N:()=>_});const r="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",i={lightSources:{}};function a({color:e=[0,0,0],intensity:t=1}={}){return e.map((e=>e*t/255))}const n={};const _={name:"gouraud-lighting",dependencies:[{name:"lights",vs:r,fs:r,getUniforms:function e(t=i){if("lightSources"in t){const{ambientLight:e,pointLights:o,directionalLights:r}=t.lightSources||{};return e||o&&o.length>0||r&&r.length>0?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:o=[]}){const r={};return r["lighting_uAmbientLight.color"]=e?a(e):[0,0,0],t.forEach(((e,t)=>{r["lighting_uPointLight[".concat(t,"].color")]=a(e),r["lighting_uPointLight[".concat(t,"].position")]=e.position,r["lighting_uPointLight[".concat(t,"].attenuation")]=e.attenuation||[1,0,0]})),r.lighting_uPointLightCount=t.length,o.forEach(((e,t)=>{r["lighting_uDirectionalLight[".concat(t,"].color")]=a(e),r["lighting_uDirectionalLight[".concat(t,"].direction")]=e.direction})),r.lighting_uDirectionalLightCount=o.length,r}({ambientLight:e,pointLights:o,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const o={pointLights:[],directionalLights:[]};for(const e of t.lights||[])switch(e.type){case"ambient":o.ambientLight=e;break;case"directional":o.directionalLights.push(e);break;case"point":o.pointLights.push(e)}return e({lightSources:o})}return{}},defines:{MAX_LIGHTS:3}}],vs:"\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",defines:{LIGHTING_VERTEX:1},getUniforms:function(e=n){if(!("material"in e))return{};const{material:t}=e;return t?function(e){const{ambient:t=.35,diffuse:o=.6,shininess:r=32,specularColor:i=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:o,lighting_uShininess:r,lighting_uSpecularColor:i.map((e=>e/255))}}(t):{lighting_uEnabled:!1}}}},639023:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>CategoricalDeckGLContainer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(328062),_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(815354),_components_Legend__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36665),_utils_colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(464106),_utils_time__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(166911),_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(621207),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const{getScale}=_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__;function getCategories(e,t){const o=e.color_picker||{r:0,g:0,b:0,a:1},r=[o.r,o.g,o.b,255*o.a],i=getScale(e.color_scheme),a={};return t.forEach((t=>{if(null!=t.cat_color&&!a.hasOwnProperty(t.cat_color)){let n;n=e.dimension?(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(i(t.cat_color),255*o.a):r,a[t.cat_color]={color:n,enabled:!0}}})),a}const propTypes={datasource:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,formData:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,getLayer:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,getPoints:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired,mapboxApiKey:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string.isRequired,onAddFilter:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,payload:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,setControlValue:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,viewport:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,width:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired};class CategoricalDeckGLContainer extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState({...this.getStateFromProps(e)})}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const o=e.payload.data.features||[],r=o.map((e=>e.__timestamp)),i=getCategories(e.formData,o);if(t&&e.payload.form_data===t.formData)return{...t,categories:i};const a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:n,end:_,getStep:s,values:l,disabled:c}=(0,_utils_time__WEBPACK_IMPORTED_MODULE_5__.g)(r,a),{width:g,height:u,formData:p}=e;let{viewport:d}=e;return p.autozoom&&(d=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__.Z)(d,{width:g,height:u,points:e.getPoints(o)})),d.zoom<0&&(d.zoom=0),{start:n,end:_,getStep:s,values:l,disabled:c,viewport:d,selected:[],lastClick:0,formData:e.payload.form_data,categories:i}}getLayers(e){const{getLayer:t,payload:o,formData:r,onAddFilter:i}=this.props;let a=o.data.features?[...o.data.features]:[];a=this.addColor(a,r),r.js_data_mutator&&(a=(0,_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__.Z)(r.js_data_mutator)(a)),a=e[0]===e[1]||e[1]===this.end?a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]));const n=this.state.categories;return r.dimension&&(a=a.filter((e=>n[e.cat_color]&&n[e.cat_color].enabled))),[t(r,{...o,data:{...o.data,features:a}},i,this.setTooltip,this.props.datasource)]}addColor(e,t){const o=t.color_picker||{r:0,g:0,b:0,a:1},r=getScale(t.color_scheme);return e.map((e=>{let i;return t.dimension?(i=(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(r(e.cat_color),255*o.a),{...e,color:i}):e}))}toggleCategory(e){const t=this.state.categories[e],o={...this.state.categories,[e]:{...t,enabled:!t.enabled}};Object.values(o).every((e=>!e.enabled))&&Object.values(o).forEach((e=>{e.enabled=!0})),this.setState({categories:o})}showSingleCategory(e){const t={...this.state.categories};Object.values(t).forEach((e=>{e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}render(){return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)("div",{style:{position:"relative"}},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_components_Legend__WEBPACK_IMPORTED_MODULE_3__.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;CategoricalDeckGLContainer.propTypes=propTypes,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(getScale,"getScale","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(getCategories,"getCategories","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(CategoricalDeckGLContainer,"CategoricalDeckGLContainer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},36665:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Legend});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(767190),_Legend_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(323270),_emotion_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const categoryDelimiter=" - ",propTypes={categories:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object,forceCategorical:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,format:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,position:prop_types__WEBPACK_IMPORTED_MODULE_1___default().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,toggleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func},defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}};class Legend extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(categoryDelimiter)){const t=e.split(categoryDelimiter);return this.format(t[0])+categoryDelimiter+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((([e,t])=>{const o={color:`rgba(${t.color.join(", ")})`},r=t.enabled?"◼":"◻";return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("li",{key:e},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("span",{style:o},r)," ",this.formatCategoryLabel(e)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("div",{className:"legend",style:t},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("ul",{className:"categories"},e))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;Legend.propTypes=propTypes,Legend.defaultProps=defaultProps,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(categoryDelimiter,"categoryDelimiter","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(Legend,"Legend","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},755573:(e,t,o)=>{o.r(t),o.d(t,{default:()=>O,getLayer:()=>P});var r=o(380744),i=o(815103),a=o(104516),n=Math.PI/3,_=[0,n,2*n,3*n,4*n,5*n];function s(e){return e[0]}function l(e){return e[1]}var c=o(838550),g=o(973728),u=o(963295);function p(){}const d={colorDomain:null,colorRange:a.K,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:p,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:p,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){const{data:o,radius:i}=e,{viewport:a,attributes:g}=t,u=o.length?function(e,t){const{attributes:o}=t,r=o.positions.value,{size:i}=o.positions.getAccessor();let a,n=1/0,_=1/0,s=-1/0,l=-1/0;for(a=0;a<i*e.length;a+=i){const e=r[a],t=r[a+1];Number.isFinite(e)&&Number.isFinite(t)&&(n=Math.min(e,n),s=Math.max(e,s),_=Math.min(t,_),l=Math.max(t,l))}return[n,_,s,l].every(Number.isFinite)?[(n+s)/2,(_+l)/2]:null}(o,t):null,p=function(e,t,o){const{unitsPerMeter:r}=t.getDistanceScales(o);return e*r[0]}(i,a,u),d=[],{iterable:h,objectInfo:f}=(0,c.jB)(o),m=g.positions.value,{size:L}=g.positions.getAccessor();for(const e of h){f.index++;const t=f.index*L,o=[m[t],m[t+1]];Number.isFinite(o[0])&&Number.isFinite(o[1])?d.push({screenCoord:a.projectFlat(o),source:e,index:f.index}):r.Z.warn("HexagonLayer: invalid position")()}const E=function(){var e,t,o,r=0,i=0,a=1,c=1,g=s,u=l;function p(e){var r,i={},a=[],n=e.length;for(r=0;r<n;++r)if(!isNaN(s=+g.call(null,_=e[r],r,e))&&!isNaN(l=+u.call(null,_,r,e))){var _,s,l,c=Math.round(l/=o),p=Math.round(s=s/t-(1&c)/2),d=l-c;if(3*Math.abs(d)>1){var h=s-p,f=p+(s<p?-1:1)/2,m=c+(l<c?-1:1),L=s-f,E=l-m;h*h+d*d>L*L+E*E&&(p=f+(1&c?1:-1)/2,c=m)}var C=p+"-"+c,D=i[C];D?D.push(_):(a.push(D=i[C]=[_]),D.x=(p+(1&c)/2)*t,D.y=c*o)}return a}function d(e){var t=0,o=0;return _.map((function(r){var i=Math.sin(r)*e,a=-Math.cos(r)*e,n=i-t,_=a-o;return t=i,o=a,[n,_]}))}return p.hexagon=function(t){return"m"+d(null==t?e:+t).join("l")+"z"},p.centers=function(){for(var n=[],_=Math.round(i/o),s=Math.round(r/t),l=_*o;l<c+e;l+=o,++_)for(var g=s*t+(1&_)*t/2;g<a+t/2;g+=t)n.push([g,l]);return n},p.mesh=function(){var t=d(e).slice(0,4).join("l");return p.centers().map((function(e){return"M"+e+"m"+t})).join("")},p.x=function(e){return arguments.length?(g=e,p):g},p.y=function(e){return arguments.length?(u=e,p):u},p.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(n),o=1.5*e,p):e},p.size=function(e){return arguments.length?(r=i=0,a=+e[0],c=+e[1],p):[a-r,c-i]},p.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],a=+e[1][0],c=+e[1][1],p):[[r,i],[a,c]]},p.radius(1)}().radius(p).x((e=>e.screenCoord[0])).y((e=>e.screenCoord[1]));return{hexagons:E(d).map(((e,t)=>({position:a.unprojectFlat([e.x,e.y]),points:e,index:t}))),radiusCommon:p}},getPosition:{type:"accessor",value:e=>e.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class h extends u.Z{shouldUpdateState({changeFlags:e}){return e.somethingChanged}initializeState(){const e=new g.Z({getAggregator:e=>e.hexagonAggregator,getCellSize:e=>e.radius});this.state={cpuAggregator:e,aggregatorState:e.state,hexagonVertices:null},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(e){super.updateState(e);const{cpuAggregator:t,hexagonVertices:o}=this.state;e.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:t.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()})});const{hexagonVertices:r}=t.state.layerData||{};if(r&&o!==r){const e=this.convertLatLngToMeterOffset(r);e&&this.setState({hexagonVertices:r,vertices:e})}else this.updateRadiusAngle()}updateRadiusAngle(e){const{viewport:t}=this.context,{unitsPerMeter:o}=t.getDistanceScales(),{cpuAggregator:r}=this.state;if(r.state.layerData&&r.state.layerData.radiusCommon){const{radiusCommon:e}=r.state.layerData,t=e/o[0];this.setState({angle:90,radius:t})}}convertLatLngToMeterOffset(e){const{viewport:t}=this.context;if(Array.isArray(e)&&6===e.length){const o=e[0],r=e[3],i=[(o[0]+r[0])/2,(o[1]+r[1])/2],a=t.projectFlat(i),{metersPerUnit:n}=t.getDistanceScales(i);return e.map((e=>{const o=t.projectFlat(e);return[(o[0]-a[0])*n[0],(o[1]-a[1])*n[1]]}))}return r.Z.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,coverage:o,material:r,transitions:a}=this.props,{angle:n,radius:_,cpuAggregator:s,vertices:l}=this.state,c=this.getSubLayerClass("hexagon-cell",i.Z),g=this._getSublayerUpdateTriggers();return new c({...l&&l.length?{vertices:l,radius:1}:{radius:_,angle:n},diskResolution:6,elevationScale:e,extruded:t,coverage:o,material:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:a&&{getFillColor:a.getColorValue||a.getColorWeight,getElevation:a.getElevationValue||a.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:g}),{data:s.state.layerData.data})}}h.layerName="HexagonLayer",h.defaultProps=d,o(667294);var f,m=o(455867),L=o(452154),E=o(621207),C=o(241667),D=o(101740),M=o(211965);function y(e){return(0,M.tZ)("div",{className:"deckgl-tooltip"},(0,M.tZ)(D.Z,{label:`${(0,m.t)("Centroid (Longitude and Latitude)")}: `,value:`(${e.coordinate[0]}, ${e.coordinate[1]})`}),(0,M.tZ)(D.Z,{label:`${(0,m.t)("Height")}: `,value:`${e.object.elevationValue}`}))}function P(e,t,o,r){const i=e,a=i.color_picker;let n=t.data.features.map((e=>({...e,color:[a.r,a.g,a.b,255*a.a]})));i.js_data_mutator&&(n=(0,E.Z)(i.js_data_mutator)(n));const _=(0,L.Z)(i.js_agg_function,(e=>e.weight));return new h({id:`hex-layer-${i.slice_id}`,data:n,pickable:!0,radius:i.grid_size,minColor:[0,0,0,0],extruded:i.extruded,maxColor:[a.r,a.g,a.b,255*a.a],outline:!1,getElevationValue:_,getColorValue:_,...(0,L.N)(i,r,y)})}function b(e){return e.map((e=>e.position))}e=o.hmd(e),(f="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&f(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const v=(0,C.G)(P,b),O=v;var A,w;(A="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(A.register(y,"setTooltipContent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.jsx"),A.register(P,"getLayer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.jsx"),A.register(b,"getPoints","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.jsx"),A.register(v,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.jsx")),(w="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&w(e)},323270:()=>{},241667:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>createDeckGLComponent,B:()=>createCategoricalDeckGLComponent});var lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(618446),lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(667294),_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(287026),_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(639023),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function createDeckGLComponent(getLayer,getPoints){class Component extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_1__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&(null==t||t.setTooltip(e))};const{width:t,height:o,formData:r}=e;let{viewport:i}=e;r.autozoom&&(i=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__.Z)(i,{width:t,height:o,points:getPoints(e.payload.data.features)})),this.state={viewport:i,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t={...e.formData,viewport:null},o={...this.props.formData,viewport:null};lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default()(t,o)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(e){const{formData:t,payload:o,onAddFilter:r}=e;return getLayer(t,o,r,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:o,height:r,width:i}=this.props,{layer:a,viewport:n}=this.state;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.F,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:n,layers:[a],mapStyle:e.mapbox_style,setControlValue:o,width:i,height:r,onViewportChange:this.onViewportChange})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}return Component}function createCategoricalDeckGLComponent(e,t){return function(o){const{datasource:r,formData:i,height:a,payload:n,setControlValue:_,viewport:s,width:l}=o;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__.Z,{datasource:r,formData:i,mapboxApiKey:n.data.mapboxApiKey,setControlValue:_,viewport:s,getLayer:e,payload:n,getPoints:t,width:l,height:a})}}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(createDeckGLComponent,"createDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx"),reactHotLoader.register(createCategoricalDeckGLComponent,"createCategoricalDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}}]);
"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2309],{803584:(e,t,r)=>{r.d(t,{Z:()=>x});var n,a=r(615078),o=r.n(a),i=r(45697),s=r.n(i),l=r(671939),c=r(767190),d=r(435778),p=r(328062);function u(e){const t=[],r=1/(e.height+1);let n=null;return e.each((e=>{e.y=r*e.depth,e.dy=r,e.parent?(e.x=n.depth===e.parent.depth?0:n.x+n.dx,e.dx=e.weight/e.parent.sum*e.parent.dx):(e.x=0,e.dx=1),n=e,t.push(e)})),t}e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const h=e=>()=>e().apply(void 0,arguments),f=s().shape({name:s().string,val:s().number.isRequired}),g={name:s().string,val:s().number.isRequired,children:s().arrayOf(s().oneOfType([s().shape(h((()=>g))),f]))},m=s().oneOfType([s().shape(g),f]),y={data:s().arrayOf(m),width:s().number,height:s().number,colorScheme:s().string,dateTimeFormat:s().string,equalDateSize:s().bool,levels:s().arrayOf(s().string),metrics:s().arrayOf(s().oneOfType([s().string,s().object])),numberFormat:s().string,partitionLimit:s().number,partitionThreshold:s().number,timeSeriesOption:s().string,useLogScale:s().bool,useRichTooltip:s().bool};function v(e){const t=[e];let r=e;for(;r.parent;)t.push(r.parent),r=r.parent;return t}function _(e,t){const{width:r,height:n,data:a,colorScheme:i,dateTimeFormat:s,equalDateSize:h,levels:f,useLogScale:g=!1,metrics:m=[],numberFormat:y,partitionLimit:_,partitionThreshold:b,useRichTooltip:x,timeSeriesOption:L="not_time"}=t,w=o().select(e);w.classed("superset-legacy-chart-partition",!0);const H=["adv_anal","time_series"].includes(L),M=(0,c.JB)(y),G=(0,d.bt)(s),P=p.getScale(i);w.selectAll("*").remove();const k=w.append("div").classed("partition-tooltip",!0);function T(e){return m.includes(e.data.name)&&H}function R(e){return e?H&&1===e?"Date":f[e-(H?2:1)]:"Metric"}function $(t,i){const s=i[t],c=r,d=n/a.length,p=o().scale.linear().range([0,c]),f=o().scale.linear().range([0,d]),m=w.append("div").attr("class","chart").style("width",`${c}px`).style("height",`${d}px`).append("svg:svg").attr("width",c).attr("height",d);t!==a.length-1&&a.length>1&&m.style("padding-bottom","3px"),0!==t&&a.length>1&&m.style("padding-top","3px");const y=(0,l.ZP)(s);function L(t,r){let n="<table>";x?v(r).reverse().forEach((e=>{const t=e.depth===r.depth;n+="<tbody>",n+=`<tr><td><div style='border: 2px solid ${t?"black":"transparent"};background-color: ${e.color};'></div></td><td>${R(e.depth)}</td><td>${e.name}</td><td>${e.disp}</td></tr>`})):(n+=`<thead><tr><td colspan="3"><strong>${R(r.depth)}</strong></td></tr></thead><tbody>`,n+=`<tr><td><div style='border: thin solid grey; background-color: ${r.color};'></div></td><td>${r.name}</td><td>${r.disp}</td></tr>`),n+="</tbody></table>";const[a,i]=o().mouse(e);t.html(n).style("left",`${a+15}px`).style("top",`${i}px`)}y.eachAfter((e=>{e.disp=e.data.val,e.value=e.disp<0?-e.disp:e.disp,e.weight=e.value,e.name=e.data.name,e.parent&&T(e.parent)&&(e.weight=h?1:e.value,e.value=e.name,e.name=G(e.name)),g&&(e.weight=Math.log(e.weight+1)),e.disp=e.disp&&!Number.isNaN(e.disp)&&Number.isFinite(e.disp)?M(e.disp):""})),y.sort(((e,t)=>{const r=t.value-e.value;return 0===r?t.name>e.name?1:-1:r})),b&&b>=0&&y.each((e=>{if(e.sum=e.children&&e.children.reduce(((e,t)=>e+t.weight),0)||1,e.children)if(T(e)){if(h)return;const t=[];for(let r=1;r<e.children.length;r+=1)e.children[r].weight/e.sum<b&&t.push(r);for(let r=t.length-1;r>=0;r-=1)e.children.splice(t[r],1)}else{let t;for(t=1;t<e.children.length&&!(e.children[t].weight/e.sum<b);t+=1);e.children=e.children.slice(0,t)}})),_&&_>=0&&y.each((e=>{e.children&&e.children.length>_&&(T(e)||(e.children=e.children.slice(0,_)))})),y.eachAfter((e=>{e.sum=e.children&&e.children.reduce(((e,t)=>e+t.weight),0)||1}));const H=u(y);let $=c/y.dx,C=d/1;function U(e){return`translate(8,${e.dx*C/2})`}const O=m.selectAll("g").data(H).enter().append("svg:g").attr("transform",(e=>`translate(${p(e.y)},${f(e.x)})`)).on("mouseover",(e=>{k.interrupt().transition().duration(100).style("opacity",.9),L(k,e)})).on("mousemove",(e=>{L(k,e)})).on("mouseout",(()=>{k.interrupt().transition().duration(250).style("opacity",0)}));O.on("click",(function e(t){if(!t.children)return!!t.parent&&e(t.parent);$=(t.y?c-40:c)/(1-t.y),C=d/t.dx,p.domain([t.y,1]).range([t.y?40:0,c]),f.domain([t.x,t.x+t.dx]);const r=O.transition().duration(o().event.altKey?7500:750).attr("transform",(e=>`translate(${p(e.y)},${f(e.x)})`));return r.select("rect").attr("width",t.dy*$).attr("height",(e=>e.dx*C)),r.select("text").attr("transform",U).style("opacity",(e=>e.dx*C>12?1:0)),o().event.stopPropagation(),!0})),O.append("svg:rect").attr("width",y.dy*$).attr("height",(e=>e.dx*C)),O.append("svg:text").attr("transform",U).attr("dy","0.35em").style("opacity",(e=>e.dx*C>12?1:0)).text((e=>e.disp?`${e.name}: ${e.disp}`:e.name)),O.selectAll("rect").style("fill",(e=>(e.color=P(e.name),e.color)))}for(let e=0;e<a.length;e+=1)$(e,a)}_.displayName="Icicle",_.propTypes=y;const b=_,x=b;var L,w;(L="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(L.register(u,"init","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(h,"lazyFunction","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(f,"leafType","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(g,"parentShape","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(m,"nodeType","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(y,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(v,"getAncestors","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(_,"Icicle","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js"),L.register(b,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/Partition.js")),(w="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&w(e)},822309:(e,t,r)=>{r.r(t),r.d(t,{default:()=>s});var n,a=r(943323),o=r(803584);e=r.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const i=(0,a.Z)(o.Z),s=i;var l,c;(l="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&l.register(i,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-partition/src/ReactPartition.js"),(c="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&c(e)},671939:(e,t,r)=>{function n(e){var t=0,r=e.children,n=r&&r.length;if(n)for(;--n>=0;)t+=r[n].value;else t=1;e.value=t}function a(e,t){var r,n,a,i,c,d=new l(e),p=+e.value&&(d.value=e.value),u=[d];for(null==t&&(t=o);r=u.pop();)if(p&&(r.value=+r.data.value),(a=t(r.data))&&(c=a.length))for(r.children=new Array(c),i=c-1;i>=0;--i)u.push(n=r.children[i]=new l(a[i])),n.parent=r,n.depth=r.depth+1;return d.eachBefore(s)}function o(e){return e.children}function i(e){e.data=e.data.data}function s(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function l(e){this.data=e,this.depth=this.height=0,this.parent=null}r.d(t,{ZP:()=>a}),l.prototype=a.prototype={constructor:l,count:function(){return this.eachAfter(n)},each:function(e){var t,r,n,a,o=this,i=[o];do{for(t=i.reverse(),i=[];o=t.pop();)if(e(o),r=o.children)for(n=0,a=r.length;n<a;++n)i.push(r[n])}while(i.length);return this},eachAfter:function(e){for(var t,r,n,a=this,o=[a],i=[];a=o.pop();)if(i.push(a),t=a.children)for(r=0,n=t.length;r<n;++r)o.push(t[r]);for(;a=i.pop();)e(a);return this},eachBefore:function(e){for(var t,r,n=this,a=[n];n=a.pop();)if(e(n),t=n.children)for(r=t.length-1;r>=0;--r)a.push(t[r]);return this},sum:function(e){return this.eachAfter((function(t){for(var r=+e(t.data)||0,n=t.children,a=n&&n.length;--a>=0;)r+=n[a].value;t.value=r}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,r=function(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),a=null;for(e=r.pop(),t=n.pop();e===t;)a=e,e=r.pop(),t=n.pop();return a}(t,e),n=[t];t!==r;)t=t.parent,n.push(t);for(var a=n.length;e!==r;)n.splice(a,0,e),e=e.parent;return n},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){var e=[];return this.each((function(t){e.push(t)})),e},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(r){r!==e&&t.push({source:r.parent,target:r})})),t},copy:function(){return a(this).eachBefore(i)}}},943323:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>reactify});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),_emotion_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function reactify(renderFn,callbacks){class ReactifiedComponent extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(e){super(e),this.container=void 0,this.setContainerRef=this.setContainerRef.bind(this)}componentDidMount(){this.execute()}componentDidUpdate(){this.execute()}componentWillUnmount(){this.container=void 0,null!=callbacks&&callbacks.componentWillUnmount&&callbacks.componentWillUnmount.bind(this)()}setContainerRef(e){this.container=e}execute(){this.container&&renderFn(this.container,this.props)}render(){const{id:e,className:t}=this.props;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_1__.tZ)("div",{ref:this.setContainerRef,id:e,className:t})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}const ReactifiedClass=ReactifiedComponent;return renderFn.displayName&&(ReactifiedClass.displayName=renderFn.displayName),renderFn.propTypes&&(ReactifiedClass.propTypes={...ReactifiedClass.propTypes,...renderFn.propTypes}),renderFn.defaultProps&&(ReactifiedClass.defaultProps=renderFn.defaultProps),ReactifiedComponent}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&reactHotLoader.register(reactify,"reactify","/Users/chenming/superset/superset-frontend/packages/superset-ui-core/src/chart/components/reactify.tsx"),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}}]);
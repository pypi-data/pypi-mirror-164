"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7982],{73995:(e,t,a)=>{a.d(t,{Z:()=>L});var n,s=a(667294),o=a(751995),r=a(431069),l=a(455867),d=a(115926),i=a.n(d),c=a(104715),u=a(737921),b=a(558347),m=a(940277),p=a(414114),h=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var f="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const g=o.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${e.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*e.gridUnit}px;\n    }\n  `}
`,v=o.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${({theme:e})=>e.gridUnit-2}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,S=({backend:e,databaseName:t})=>(0,h.tZ)(v,null,(0,h.tZ)(u.Z,{className:"backend"},e),(0,h.tZ)("span",{className:"name",title:t},t));function L({db:e,formMode:t=!1,getDbList:a,handleError:n,isDatabaseSelectEnabled:o=!0,onDbChange:d,onSchemaChange:u,onSchemasLoad:f,readOnly:v=!1,schema:L,sqlLabMode:x=!1}){const[Z,y]=(0,s.useState)(!1),[w,_]=(0,s.useState)([]),[C,T]=(0,s.useState)(e?{label:(0,h.tZ)(S,{backend:e.backend,databaseName:e.database_name}),value:e.id,...e}:void 0),[G,H]=(0,s.useState)(L?{label:L,value:L}:void 0),[k,D]=(0,s.useState)(0),{addSuccessToast:U}=(0,p.e)(),$=(0,s.useMemo)((()=>async(e,s,o)=>{const d=`/api/v1/database/?q=${i().encode({order_columns:"database_name",order_direction:"asc",page:s,page_size:o,...t||!x?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return r.Z.get({endpoint:d}).then((({json:e})=>{const{result:t}=e;a&&a(t),0===t.length&&n((0,l.t)("It seems you don't have access to any database"));const s=t.map((e=>({label:(0,h.tZ)(S,{backend:e.backend,databaseName:e.database_name}),value:e.id,id:e.id,database_name:e.database_name,backend:e.backend,allow_multi_schema_metadata_fetch:e.allow_multi_schema_metadata_fetch})));return{data:s,totalCount:s.length}}))}),[t,a,n,x]);function M(e,t){return(0,h.tZ)("div",{className:"section"},(0,h.tZ)("span",{className:"select"},e),(0,h.tZ)("span",{className:"refresh"},t))}return(0,s.useEffect)((()=>{if(C){y(!0);const e=i().encode({force:k>0}),t=`/api/v1/database/${C.value}/schemas/?q=${e}`;r.Z.get({endpoint:t}).then((({json:e})=>{const t=e.result.map((e=>({value:e,label:e,title:e})));f&&f(t),_(t),y(!1),k>0&&U("List refreshed")})).catch((()=>{y(!1),n((0,l.t)("There was an error loading the schemas"))}))}}),[C,f,k]),(0,h.tZ)(g,{"data-test":"DatabaseSelector"},M((0,h.tZ)(c.Ph,{ariaLabel:(0,l.t)("Select database or type database name"),optionFilterProps:["database_name","value"],"data-test":"select-database",header:(0,h.tZ)(b.lX,null,(0,l.t)("Database")),lazyLoading:!1,onChange:function(e,t){T(t),H(void 0),d&&d(t),u&&u(void 0)},value:C,placeholder:(0,l.t)("Select database or type database name"),disabled:!o||v,options:$}),null),function(){const e=!t&&!v&&(0,h.tZ)(m.Z,{onClick:()=>D(k+1),tooltipContent:(0,l.t)("Force refresh schema list")});return M((0,h.tZ)(c.Ph,{ariaLabel:(0,l.t)("Select schema or type schema name"),disabled:v,header:(0,h.tZ)(b.lX,null,(0,l.t)("Schema")),labelInValue:!0,lazyLoading:!1,loading:Z,name:"select-schema",placeholder:(0,l.t)("Select schema or type schema name"),onChange:e=>function(e){H(e),u&&u(e.value)}(e),options:w,showSearch:!0,value:G}),e)}())}var x,Z;f(L,"useState{[loadingSchemas, setLoadingSchemas](false)}\nuseState{[schemaOptions, setSchemaOptions]([])}\nuseState{[currentDb, setCurrentDb](db\n        ? {\n            label: (<SelectLabel backend={db.backend} databaseName={db.database_name}/>),\n            value: db.id,\n            ...db,\n        }\n        : undefined)}\nuseState{[currentSchema, setCurrentSchema](schema ? { label: schema, value: schema } : undefined)}\nuseState{[refresh, setRefresh](0)}\nuseToasts{{ addSuccessToast }}\nuseMemo{loadDatabases}\nuseEffect{}",(()=>[p.e])),(x="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(x.register(g,"DatabaseSelectorWrapper","/Users/chenming/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),x.register(v,"LabelStyle","/Users/chenming/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),x.register(S,"SelectLabel","/Users/chenming/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),x.register(L,"DatabaseSelector","/Users/chenming/superset/superset-frontend/src/components/DatabaseSelector/index.tsx")),(Z="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&Z(e)},940277:(e,t,a)=>{a.d(t,{Z:()=>c});var n,s=a(667294),o=a(358593),r=a(87693),l=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const d=({onClick:e,tooltipContent:t})=>{const a=(0,s.forwardRef)(((e,t)=>(0,l.tZ)(r.Z.Refresh,e)));return(0,l.tZ)(o.u,{title:t},(0,l.tZ)(a,{role:"button",onClick:e,css:e=>({cursor:"pointer",color:e.colors.grayscale.base,"&:hover":{color:e.colors.primary.base}})}))},i=d,c=i;var u,b;(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register(d,"RefreshLabel","/Users/chenming/superset/superset-frontend/src/components/RefreshLabel/index.tsx"),u.register(i,"default","/Users/chenming/superset/superset-frontend/src/components/RefreshLabel/index.tsx")),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&b(e)},517982:(e,t,a)=>{a.d(t,{Z:()=>y});var n,s=a(667294),o=a(751995),r=a(431069),l=a(455867),d=a(104715),i=a(558347),c=a(87693),u=a(73995),b=a(940277),m=a(679789),p=a(486057),h=a(414114),f=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var g="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const v=o.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n    }\n  `}
`,S=o.iK.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,L=({table:e})=>{const{label:t,type:a,extra:n}=e;return(0,f.tZ)(S,{title:t},"view"===a?(0,f.tZ)(c.Z.Eye,{iconSize:"m"}):(0,f.tZ)(c.Z.Table,{iconSize:"m"}),(null==n?void 0:n.certification)&&(0,f.tZ)(m.Z,{certifiedBy:n.certification.certified_by,details:n.certification.details,size:"l"}),(null==n?void 0:n.warning_markdown)&&(0,f.tZ)(p.Z,{warningMarkdown:n.warning_markdown,size:"l"}),t)},x=({database:e,formMode:t=!1,getDbList:a,handleError:n,isDatabaseSelectEnabled:o=!0,onDbChange:c,onSchemaChange:m,onSchemasLoad:p,onTableChange:g,onTablesLoad:S,readOnly:x=!1,schema:Z,sqlLabMode:y=!0,tableName:w})=>{const[_,C]=(0,s.useState)(e),[T,G]=(0,s.useState)(Z),[H,k]=(0,s.useState)(),[D,U]=(0,s.useState)(0),[$,M]=(0,s.useState)(0),[E,N]=(0,s.useState)(!1),[R,O]=(0,s.useState)([]),{addSuccessToast:z}=(0,h.e)();(0,s.useEffect)((()=>{void 0===e&&(C(void 0),G(void 0),k(void 0))}),[e]),(0,s.useEffect)((()=>{if(_&&T){N(!0);const e=encodeURIComponent(T),t=D!==$,a=encodeURI(`/superset/tables/${_.id}/${e}/undefined/${t}/`);$!==D&&M(D),r.Z.get({endpoint:a}).then((({json:e})=>{const a=[];let n;e.options.forEach((e=>{const t={value:e.value,label:(0,f.tZ)(L,{table:e}),text:e.label};a.push(t),e.label===w&&(n=t)})),S&&S(e.options),O(a),k(n),N(!1),t&&z("List updated")})).catch((e=>{N(!1),n((0,l.t)("There was an error loading the tables"))}))}}),[_,T,S,D]);const q=e=>{k(e),g&&T&&g(null==e?void 0:e.value,T)},I=(0,s.useMemo)((()=>(e,t)=>{const a=e.trim().toLowerCase(),{text:n}=t;return n.toLowerCase().includes(a)}),[]);return(0,f.tZ)(v,null,(0,f.tZ)(u.Z,{key:null==_?void 0:_.id,db:_,formMode:t,getDbList:a,handleError:n,onDbChange:x?void 0:e=>{C(e),c&&c(e)},onSchemaChange:x?void 0:e=>{G(e),m&&m(e),q(void 0)},onSchemasLoad:p,schema:T,sqlLabMode:y,isDatabaseSelectEnabled:o&&!x,readOnly:x}),y&&!t&&(0,f.tZ)("div",{className:"divider"}),function(){const a=T&&!t&&x||!T&&!(null!=e&&e.allow_multi_schema_metadata_fetch),n=y?(0,f.tZ)(i.lX,null,(0,l.t)("See table schema")):(0,f.tZ)(i.lX,null,(0,l.t)("Table"));return s=(0,f.tZ)(d.Ph,{ariaLabel:(0,l.t)("Select table or type table name"),disabled:a,filterOption:I,header:n,labelInValue:!0,lazyLoading:!1,loading:E,name:"select-table",onChange:e=>q(e),options:R,placeholder:(0,l.t)("Select table or type table name"),showSearch:!0,value:H}),o=!t&&!x&&(0,f.tZ)(b.Z,{onClick:()=>U(D+1),tooltipContent:(0,l.t)("Force refresh table list")}),(0,f.tZ)("div",{className:"section"},(0,f.tZ)("span",{className:"select"},s),(0,f.tZ)("span",{className:"refresh"},o));var s,o}())};g(x,"useState{[currentDatabase, setCurrentDatabase](database)}\nuseState{[currentSchema, setCurrentSchema](schema)}\nuseState{[currentTable, setCurrentTable]}\nuseState{[refresh, setRefresh](0)}\nuseState{[previousRefresh, setPreviousRefresh](0)}\nuseState{[loadingTables, setLoadingTables](false)}\nuseState{[tableOptions, setTableOptions]([])}\nuseToasts{{ addSuccessToast }}\nuseEffect{}\nuseEffect{}\nuseMemo{handleFilterOption}",(()=>[h.e]));const Z=x,y=Z;var w,_;(w="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(w.register(v,"TableSelectorWrapper","/Users/chenming/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(S,"TableLabel","/Users/chenming/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(L,"TableOption","/Users/chenming/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(x,"TableSelector","/Users/chenming/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(Z,"default","/Users/chenming/superset/superset-frontend/src/components/TableSelector/index.tsx")),(_="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&_(e)}}]);
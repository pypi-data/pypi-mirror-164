"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5605,7275,8146],{639023:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>CategoricalDeckGLContainer});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(328062),_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(815354),_components_Legend__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36665),_utils_colors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(464106),_utils_time__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(166911),_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(621207),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const{getScale}=_superset_ui_core__WEBPACK_IMPORTED_MODULE_8__;function getCategories(e,t){const _=e.color_picker||{r:0,g:0,b:0,a:1},r=[_.r,_.g,_.b,255*_.a],o=getScale(e.color_scheme),a={};return t.forEach((t=>{if(null!=t.cat_color&&!a.hasOwnProperty(t.cat_color)){let s;s=e.dimension?(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(o(t.cat_color),255*_.a):r,a[t.cat_color]={color:s,enabled:!0}}})),a}const propTypes={datasource:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,formData:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,getLayer:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,getPoints:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,height:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired,mapboxApiKey:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string.isRequired,onAddFilter:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,payload:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,setControlValue:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func.isRequired,viewport:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object.isRequired,width:prop_types__WEBPACK_IMPORTED_MODULE_1___default().number.isRequired};class CategoricalDeckGLContainer extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState({...this.getStateFromProps(e)})}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const _=e.payload.data.features||[],r=_.map((e=>e.__timestamp)),o=getCategories(e.formData,_);if(t&&e.payload.form_data===t.formData)return{...t,categories:o};const a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:s,end:i,getStep:l,values:n,disabled:c}=(0,_utils_time__WEBPACK_IMPORTED_MODULE_5__.g)(r,a),{width:p,height:d,formData:u}=e;let{viewport:g}=e;return u.autozoom&&(g=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_7__.Z)(g,{width:p,height:d,points:e.getPoints(_)})),g.zoom<0&&(g.zoom=0),{start:s,end:i,getStep:l,values:n,disabled:c,viewport:g,selected:[],lastClick:0,formData:e.payload.form_data,categories:o}}getLayers(e){const{getLayer:t,payload:_,formData:r,onAddFilter:o}=this.props;let a=_.data.features?[..._.data.features]:[];a=this.addColor(a,r),r.js_data_mutator&&(a=(0,_utils_sandbox__WEBPACK_IMPORTED_MODULE_6__.Z)(r.js_data_mutator)(a)),a=e[0]===e[1]||e[1]===this.end?a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]));const s=this.state.categories;return r.dimension&&(a=a.filter((e=>s[e.cat_color]&&s[e.cat_color].enabled))),[t(r,{..._,data:{..._.data,features:a}},o,this.setTooltip,this.props.datasource)]}addColor(e,t){const _=t.color_picker||{r:0,g:0,b:0,a:1},r=getScale(t.color_scheme);return e.map((e=>{let o;return t.dimension?(o=(0,_utils_colors__WEBPACK_IMPORTED_MODULE_4__.hexToRGB)(r(e.cat_color),255*_.a),{...e,color:o}):e}))}toggleCategory(e){const t=this.state.categories[e],_={...this.state.categories,[e]:{...t,enabled:!t.enabled}};Object.values(_).every((e=>!e.enabled))&&Object.values(_).forEach((e=>{e.enabled=!0})),this.setState({categories:_})}showSingleCategory(e){const t={...this.state.categories};Object.values(t).forEach((e=>{e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}render(){return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)("div",{style:{position:"relative"}},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_AnimatableDeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_9__.tZ)(_components_Legend__WEBPACK_IMPORTED_MODULE_3__.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;CategoricalDeckGLContainer.propTypes=propTypes,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(getScale,"getScale","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(getCategories,"getCategories","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx"),reactHotLoader.register(CategoricalDeckGLContainer,"CategoricalDeckGLContainer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/CategoricalDeckGLContainer.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},36665:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Legend});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(767190),_Legend_css__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(323270),_emotion_react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const categoryDelimiter=" - ",propTypes={categories:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object,forceCategorical:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,format:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,position:prop_types__WEBPACK_IMPORTED_MODULE_1___default().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,toggleCategory:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func},defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}};class Legend extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,_superset_ui_core__WEBPACK_IMPORTED_MODULE_3__.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(categoryDelimiter)){const t=e.split(categoryDelimiter);return this.format(t[0])+categoryDelimiter+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((([e,t])=>{const _={color:`rgba(${t.color.join(", ")})`},r=t.enabled?"◼":"◻";return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("li",{key:e},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("span",{style:_},r)," ",this.formatCategoryLabel(e)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("div",{className:"legend",style:t},(0,_emotion_react__WEBPACK_IMPORTED_MODULE_4__.tZ)("ul",{className:"categories"},e))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}var reactHotLoader,leaveModule;Legend.propTypes=propTypes,Legend.defaultProps=defaultProps,reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(categoryDelimiter,"categoryDelimiter","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx"),reactHotLoader.register(Legend,"Legend","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/components/Legend.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},714228:(e,t,_)=>{_.r(t),_.d(t,{getLayer:()=>p,default:()=>g});var r,o=_(762112),a=(_(667294),_(452154)),s=_(621207),i=_(241667),l=_(101740),n=_(211965);function c(e){return e.object.extraProps&&(0,n.tZ)("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map(((t,_)=>(0,n.tZ)(l.Z,{key:`prop-${_}`,label:`${t}: `,value:`${e.object.extraProps[t]}`}))))}function p(e,t,_,r){const i=e,l=i.color_picker,n=[l.r,l.g,l.b,255*l.a];let p=t.data.features.map((e=>({...e,path:e.path,width:i.line_width,color:n})));return i.js_data_mutator&&(p=(0,s.Z)(i.js_data_mutator)(p)),new o.Z({id:`path-layer-${i.slice_id}`,getColor:e=>e.color,getPath:e=>e.path,getWidth:e=>e.width,data:p,rounded:!0,widthScale:1,...(0,a.N)(i,r,c)})}function d(e){let t=[];return e.forEach((e=>{t=t.concat(e.path)})),t}e=_.hmd(e),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&r(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const u=(0,i.G)(p,d),g=u;var E,h;(E="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(E.register(c,"setTooltipContent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.jsx"),E.register(p,"getLayer","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.jsx"),E.register(d,"getPoints","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.jsx"),E.register(u,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.jsx")),(h="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&h(e)},323270:()=>{},241667:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>createDeckGLComponent,B:()=>createCategoricalDeckGLComponent});var lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(618446),lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash_isEqual__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(667294),_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(287026),_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(639023),_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(74020),_emotion_react__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function createDeckGLComponent(getLayer,getPoints){class Component extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent{constructor(e){super(e),this.containerRef=react__WEBPACK_IMPORTED_MODULE_1__.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&(null==t||t.setTooltip(e))};const{width:t,height:_,formData:r}=e;let{viewport:o}=e;r.autozoom&&(o=(0,_utils_fitViewport__WEBPACK_IMPORTED_MODULE_4__.Z)(o,{width:t,height:_,points:getPoints(e.payload.data.features)})),this.state={viewport:o,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t={...e.formData,viewport:null},_={...this.props.formData,viewport:null};lodash_isEqual__WEBPACK_IMPORTED_MODULE_0___default()(t,_)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(e){const{formData:t,payload:_,onAddFilter:r}=e;return getLayer(t,_,r,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:_,height:r,width:o}=this.props,{layer:a,viewport:s}=this.state;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_DeckGLContainer__WEBPACK_IMPORTED_MODULE_2__.F,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[a],mapStyle:e.mapbox_style,setControlValue:_,width:o,height:r,onViewportChange:this.onViewportChange})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}return Component}function createCategoricalDeckGLComponent(e,t){return function(_){const{datasource:r,formData:o,height:a,payload:s,setControlValue:i,viewport:l,width:n}=_;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_5__.tZ)(_CategoricalDeckGLContainer__WEBPACK_IMPORTED_MODULE_3__.Z,{datasource:r,formData:o,mapboxApiKey:s.data.mapboxApiKey,setControlValue:i,viewport:l,getLayer:e,payload:s,getPoints:t,width:n,height:a})}}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(createDeckGLComponent,"createDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx"),reactHotLoader.register(createCategoricalDeckGLComponent,"createCategoricalDeckGLComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/factory.tsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}}]);
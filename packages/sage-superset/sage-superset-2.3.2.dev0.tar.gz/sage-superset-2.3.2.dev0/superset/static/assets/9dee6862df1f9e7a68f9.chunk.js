"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7870],{797870:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p}),n(667294);var r,a=n(943323),o=n(751995),s=n(45697),i=n.n(s),c=n(254048),u=n(211965);e=n.hmd(e),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&r(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const l=(0,a.Z)(c.Z),d=({className:e,...t})=>(0,u.tZ)("div",{className:e},(0,u.tZ)(l,t));d.propTypes={className:i().string.isRequired};const f=(0,o.iK)(d)`
  .superset-legacy-chart-sankey {
    .node {
      rect {
        cursor: move;
        fill-opacity: 0.9;
        shape-rendering: crispEdges;
      }
      text {
        pointer-events: none;
        text-shadow: 0 1px 0 #fff;
        font-size: ${({fontSize:e})=>e}em;
      }
    }
    .link {
      fill: none;
      stroke: #000;
      stroke-opacity: 0.2;
      &:hover {
        stroke-opacity: 0.5;
      }
    }
    .opacity-0 {
      opacity: 0;
    }
  }
  .sankey-tooltip {
    position: absolute;
    width: auto;
    background: #ddd;
    padding: 10px;
    font-size: ${({fontSize:e})=>e}em;
    font-weight: ${({theme:e})=>e.typography.weights.light};
    color: #000;
    border: 1px solid #fff;
    text-align: center;
    pointer-events: none;
  }
`,p=f;var y,h;(y="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(y.register(l,"ReactSanKey","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/ReactSankey.jsx"),y.register(d,"SankeyComponent","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/ReactSankey.jsx"),y.register(f,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/ReactSankey.jsx")),(h="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&h(e)},254048:(e,t,n)=>{n.d(t,{Z:()=>_});var r=n(615078),a=n.n(r),o=n(45697),s=n.n(o),i=n(804065),c=n(331654),u=n(873626);var l,d=n(767190),f=n(645636),p=n(328062),y=n(351824);e=n.hmd(e),(l="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&l(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const h={data:s().arrayOf(s().shape({source:s().string,target:s().string,value:s().number})),width:s().number,height:s().number,colorScheme:s().string},g=(0,d.JB)(f.Z.FLOAT);function m(e,t){const{data:n,width:r,height:o,colorScheme:s}=t,l=a().select(e);l.classed("superset-legacy-chart-sankey",!0);const d=r-5-5,f=o-5-5;l.selectAll("*").remove();const h=l.append("div").attr("class","sankey-tooltip").style("opacity",0),m=l.append("svg").attr("width",d+5+5).attr("height",f+5+5).append("g").attr("transform","translate(5,5)"),v=p.getScale(s),_=function(){var e={},t=24,n=8,r=[1,1],a=[],o=[];function s(){function e(e,t){return e.source.y-t.source.y}function t(e,t){return e.target.y-t.target.y}a.forEach((function(n){n.sourceLinks.sort(t),n.targetLinks.sort(e)})),a.forEach((function(e){var t=0,n=0;e.sourceLinks.forEach((function(e){e.sy=t,t+=e.dy})),e.targetLinks.forEach((function(e){e.ty=n,n+=e.dy}))}))}function l(e){return e.y+e.dy/2}function d(e){return e.value}return e.nodeWidth=function(n){return arguments.length?(t=+n,e):t},e.nodePadding=function(t){return arguments.length?(n=+t,e):n},e.nodes=function(t){return arguments.length?(a=t,e):a},e.links=function(t){return arguments.length?(o=t,e):o},e.size=function(t){return arguments.length?(r=t,e):r},e.layout=function(u){return a.forEach((function(e){e.sourceLinks=[],e.targetLinks=[]})),o.forEach((function(e){var t=e.source,n=e.target;"number"==typeof t&&(t=e.source=a[e.source]),"number"==typeof n&&(n=e.target=a[e.target]),t.sourceLinks.push(e),n.targetLinks.push(e)})),a.forEach((function(e){e.value=Math.max((0,i.sum)(e.sourceLinks,d),(0,i.sum)(e.targetLinks,d))})),function(){for(var e,n,o=a,s=0;o.length;)e=[],o.forEach((function(n){n.x=s,n.dx=t,n.sourceLinks.forEach((function(t){e.indexOf(t.target)<0&&e.push(t.target)}))})),o=e,++s;(function(e){a.forEach((function(t){t.sourceLinks.length||(t.x=e-1)}))})(s),n=(r[0]-t)/(s-1),a.forEach((function(e){e.x*=n}))}(),function(e){var t,s=(0,c.b1)().key((function(e){return e.x})).sortKeys(i.ascending).entries(a).map((function(e){return e.values}));t=(0,i.min)(s,(function(e){return(r[1]-(e.length-1)*n)/(0,i.sum)(e,d)})),s.forEach((function(e){e.forEach((function(e,n){e.y=n,e.dy=e.value*t}))})),o.forEach((function(e){e.dy=e.value*t})),y();for(var u=1;e>0;--e)p(u*=.99),y(),f(u),y();function f(e){function t(e){return l(e.source)*e.value}s.forEach((function(n){n.forEach((function(n){if(n.targetLinks.length){var r=(0,i.sum)(n.targetLinks,t)/(0,i.sum)(n.targetLinks,d);n.y+=(r-l(n))*e}}))}))}function p(e){function t(e){return l(e.target)*e.value}s.slice().reverse().forEach((function(n){n.forEach((function(n){if(n.sourceLinks.length){var r=(0,i.sum)(n.sourceLinks,t)/(0,i.sum)(n.sourceLinks,d);n.y+=(r-l(n))*e}}))}))}function y(){s.forEach((function(e){var t,a,o,s=0,i=e.length;for(e.sort(h),o=0;o<i;++o)(a=s-(t=e[o]).y)>0&&(t.y+=a),s=t.y+t.dy+n;if((a=s-n-r[1])>0)for(s=t.y-=a,o=i-2;o>=0;--o)(a=(t=e[o]).y+t.dy+n-s)>0&&(t.y-=a),s=t.y}))}function h(e,t){return e.y-t.y}}(u),s(),e},e.relayout=function(){return s(),e},e.link=function(){var e=.5;function t(t){var n=t.source.x+t.source.dx,r=t.target.x,a=(0,u.Z)(n,r),o=a(e),s=a(1-e),i=t.source.y+t.sy+t.dy/2,c=t.target.y+t.ty+t.dy/2;return"M"+n+","+i+"C"+o+","+i+" "+s+","+c+" "+r+","+c}return t.curvature=function(n){return arguments.length?(e=+n,t):e},t},e}().nodeWidth(15).nodePadding(10).size([d,f]),k=_.link();let b={};const L=n.map((e=>{const t={...e};return t.source=b[t.source]||(b[t.source]={name:t.source}),t.target=b[t.target]||(b[t.target]={name:t.target}),t.value=Number(t.value),t}));function x(e){h.html((()=>function(e){let t;if(e.sourceLinks)t=`${e.name} Value: <span class='emph'>${g(e.value)}</span>`;else{const n=g(e.value),r=a().round(e.value/e.source.value*100,1),o=a().round(e.value/e.target.value*100,1);t=["<div class=''>Path Value: <span class='emph'>",n,"</span></div>","<div class='percents'>","<span class='emph'>",Number.isFinite(r)?r:"100","%</span> of ",e.source.name,"<br/>",`<span class='emph'>${Number.isFinite(o)?o:"--"}%</span> of `,e.target.name,"</div>"].join("")}return t}(e))).transition().duration(200);const{height:t,width:n}=h.node().getBoundingClientRect();h.style("left",`${Math.min(a().event.offsetX+10,r-n)}px`).style("top",`${Math.min(a().event.offsetY+10,o-t)}px`).style("position","absolute").style("opacity",.95)}function E(){h.transition().duration(100).style("opacity",0)}b=a().values(b),_.nodes(b).links(L).layout(32);const M=m.append("g").selectAll(".link").data(L).enter().append("path").attr("class","link").attr("d",k).style("stroke-width",(e=>Math.max(1,e.dy))).sort(((e,t)=>t.dy-e.dy)).on("mouseover",x).on("mouseout",E);function H(){var e;const t=null!=(e=l.selectAll(".node")[0])?e:[],n=(0,y.Ce)(t);t.forEach((e=>{const t=e.getElementsByTagName("text")[0];t&&(n.includes(e)?t.classList.add("opacity-0"):t.classList.remove("opacity-0"))}))}const G=m.append("g").selectAll(".node").data(b).enter().append("g").attr("class","node").attr("transform",(e=>`translate(${e.x},${e.y})`)).call(a().behavior.drag().origin((e=>e)).on("dragstart",(function(){this.parentNode.append(this)})).on("drag",(function(e){a().select(this).attr("transform",`translate(${e.x},${e.y=Math.max(0,Math.min(o-e.dy,a().event.y))})`),_.relayout(),M.attr("d",k)})).on("dragend",H));G.append("rect").attr("height",(e=>e.dy>5?e.dy:5)).attr("width",_.nodeWidth()).style("fill",(e=>{const t=e.name||"N/A";return e.color=v(t.replace(/ .*/,"")),e.color})).style("stroke",(e=>a().rgb(e.color).darker(2))).on("mouseover",x).on("mouseout",E),G.append("text").attr("x",-6).attr("y",(e=>e.dy/2)).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text((e=>e.name)).attr("class","opacity-0").filter((e=>e.x<d/2)).attr("x",6+_.nodeWidth()).attr("text-anchor","start"),H()}m.displayName="Sankey",m.propTypes=h;const v=m,_=v;var k,b;(k="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(k.register(h,"propTypes","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/Sankey.js"),k.register(g,"formatNumber","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/Sankey.js"),k.register(m,"Sankey","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/Sankey.js"),k.register(v,"default","/Users/chenming/superset/superset-frontend/plugins/legacy-plugin-chart-sankey/src/Sankey.js")),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&b(e)},943323:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>reactify});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),_emotion_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function reactify(renderFn,callbacks){class ReactifiedComponent extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(e){super(e),this.container=void 0,this.setContainerRef=this.setContainerRef.bind(this)}componentDidMount(){this.execute()}componentDidUpdate(){this.execute()}componentWillUnmount(){this.container=void 0,null!=callbacks&&callbacks.componentWillUnmount&&callbacks.componentWillUnmount.bind(this)()}setContainerRef(e){this.container=e}execute(){this.container&&renderFn(this.container,this.props)}render(){const{id:e,className:t}=this.props;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_1__.tZ)("div",{ref:this.setContainerRef,id:e,className:t})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}const ReactifiedClass=ReactifiedComponent;return renderFn.displayName&&(ReactifiedClass.displayName=renderFn.displayName),renderFn.propTypes&&(ReactifiedClass.propTypes={...ReactifiedClass.propTypes,...renderFn.propTypes}),renderFn.defaultProps&&(ReactifiedClass.defaultProps=renderFn.defaultProps),ReactifiedComponent}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&reactHotLoader.register(reactify,"reactify","/Users/chenming/superset/superset-frontend/packages/superset-ui-core/src/chart/components/reactify.tsx"),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}}]);
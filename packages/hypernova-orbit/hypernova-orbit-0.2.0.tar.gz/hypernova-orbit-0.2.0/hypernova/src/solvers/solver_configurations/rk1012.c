#include "../solver_configurations.h"
#include <math.h>

double rk1012_error_correlation(double h, double F[MAX_BUTCHER_TABLEAU_SIZE][VEC_SIZE])
{
    // F: array of slopes at each stage

    // error = 49/640 * h * (F[1] - F[23])
    double err_vector[3] = {0.0, 0.0, 0.0};
    for (size_t component = 0; component < 3; component++)
    // only take position component of error
    {
        err_vector[component] = 49. / 640. * h * (F[1][component] - F[23][component]);
    }

    return sqrt(err_vector[0] * err_vector[0] + err_vector[1] * err_vector[1] + err_vector[2] * err_vector[2]);
}

RKSolver rk1012()
{
    static const double RK1012_a[25][25] = {
        {
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.2000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            -0.2160493827160494,
            0.7716049382716049,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.2083333333333333,
            0.0000000000000000,
            0.6250000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1933333333333333,
            0.0000000000000000,
            0.2200000000000000,
            -0.0800000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.4000000000000000,
            0.5000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1033644716500105,
            0.0000000000000000,
            0.0000000000000000,
            0.1240530945289468,
            0.4831711675610329,
            -0.0387530245694763,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1240382614318333,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.2170506321979585,
            0.0137455792075967,
            -0.0661095317267683,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0914774894856883,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.0054434852371747,
            0.0680716801688453,
            0.4083943155826411,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0890013652502551,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0049952822664553,
            0.3979182388198290,
            0.4279302107525766,
            -0.0865117637557827,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0695087624134908,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.1291469419001764,
            1.5307363810231129,
            0.5778747611291400,
            -0.9512947723210889,
            -0.4082766429656319,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0444861403295136,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.0038047686705696,
            0.0106955064029624,
            0.0209616244499904,
            -0.0233146023259322,
            0.0026326598106454,
            0.0031547276897703,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0194588815119755,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000678512949172,
            -0.0000429795859049,
            0.0000176358982260,
            0.0653866627415027,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.2068368356642771,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0166796067104156,
            -0.0087950156320071,
            0.0034667545536246,
            -0.8612644601057177,
            0.9086518820740502,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.0203926084654484,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0869469392016686,
            -0.0191649630410150,
            0.0065562915949366,
            0.0987476128127435,
            0.0053536469552500,
            0.3011678640109679,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.2284104339177781,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.4987074007930252,
            0.1348411683357245,
            -0.0387458244055834,
            -1.2747325747347484,
            1.4391636446287717,
            -0.2140074679679903,
            0.9582024177544303,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            2.0022247765597418,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            2.0670180996152490,
            0.6239781360861395,
            -0.0462283685500311,
            -8.8497328836264959,
            7.7425770785085595,
            -0.5883585192508692,
            -1.1068373336238064,
            -0.9295290375792040,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            3.1378953341207345,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.1291469419001764,
            1.5307363810231129,
            0.5778747611291400,
            5.4208826305512670,
            0.2315469260348293,
            0.0759292995578913,
            -12.3729973380186511,
            9.8545588346476958,
            0.0859111431370436,
            -5.6524275286264389,
            -1.9430093524281962,
            -0.1283526018494045,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            1.3836005443219601,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0049952822664553,
            0.3979182388198290,
            0.4279302107525766,
            -1.3029910742447577,
            0.6612922786693770,
            -0.1445597743069544,
            -6.9657603473179819,
            6.6580854323599175,
            -1.6699737510884149,
            2.0641370231803529,
            -0.6747439626443065,
            -0.0011561883479494,
            -0.0054405790867701,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.9512362970482877,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.2170506321979585,
            0.0137455792075967,
            -0.0661095317267683,
            0.0000000000000000,
            0.1522816967364145,
            -0.3377410183575998,
            -0.0192825981633996,
            -3.6825926969686682,
            3.1619787040698206,
            -0.3704625221068853,
            -0.0514974200365440,
            -0.0008296255321202,
            0.0000027980104142,
            0.0418603916412360,
            0.2790842550908774,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1033644716500105,
            0.0000000000000000,
            0.0000000000000000,
            0.1240530945289468,
            0.4831711675610329,
            -0.0387530245694763,
            0.0000000000000000,
            -0.4383138203611224,
            0.0000000000000000,
            -0.2186366337216767,
            -0.0312334764394719,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0312334764394719,
            0.2186366337216767,
            0.4383138203611224,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.1933333333333333,
            0.0000000000000000,
            0.2200000000000000,
            -0.0800000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0984256130499316,
            -0.1964108892230547,
            0.0000000000000000,
            0.4364579304930687,
            0.0652613721675721,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            -0.0652613721675721,
            -0.4364579304930687,
            0.1964108892230547,
            -0.0984256130499316,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            -0.2160493827160494,
            0.7716049382716049,
            0.0000000000000000,
            0.0000000000000000,
            -0.6666666666666666,
            0.0000000000000000,
            -0.3906964692959785,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.3906964692959785,
            0.6666666666666666,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            0.2000000000000000,
            0.0000000000000000,
            -0.1646090534979424,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.0000000000000000,
            0.1646090534979424,
            0.0000000000000000,
            0.0000000000000000,
        },
        {
            1.4717872488111041,
            0.7875000000000000,
            0.4212962962962963,
            0.0000000000000000,
            0.2916666666666667,
            0.0000000000000000,
            0.3486007176283296,
            0.2294995447689948,
            5.7904648579048201,
            0.4185875118565069,
            0.3070398802224740,
            -4.6870090535060331,
            3.1357166559380225,
            1.4013482971096571,
            -5.5293110143949900,
            -0.8531382355080633,
            0.1035757803736101,
            -0.1404744169506009,
            -0.4185875118565069,
            -0.2294995447689948,
            -0.3486007176283296,
            -0.2916666666666667,
            -0.4212962962962963,
            -0.7875000000000000,
            0.0000000000000000,
        },
    };
    static const double RK1012_b[25] = {0.023809523809523808, 0.0234375, 0.03125, 0.0, 0.041666666666666664, 0.0, 0.05, 0.05, 0.0, 0.1, 0.07142857142857142, 0.0, 0.13841302368078298, 0.2158726906049313, 0.2438095238095238, 0.2158726906049313, 0.13841302368078298, -0.07142857142857142, -0.1, -0.05, -0.05, -0.041666666666666664, -0.03125, -0.0234375, 0.023809523809523808};
    static const double RK1012_c[25] = {0.0, 0.2, 0.5555555555555556, 0.8333333333333334, 0.3333333333333333, 1.0, 0.6718357091705138, 0.2887249411106202, 0.5625, 0.8333333333333334, 0.9476954311791993, 0.054811287686380265, 0.08488805186071653, 0.2655756032646429, 0.5, 0.7344243967353571, 0.9151119481392834, 0.9476954311791993, 0.8333333333333334, 0.2887249411106202, 0.6718357091705138, 0.3333333333333333, 0.5555555555555556, 0.2, 1.0};

    static const ButcherTableau weights = {
        .A = RK1012_a,
        .b = RK1012_b,
        .c = RK1012_c};

    static RKSolver solver = {
        .weights = &weights,
        .err_corr = rk1012_error_correlation,
        .is_adaptive = true,
        .num_stages = 25,
        .order = 12};
    return solver;
}